"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function LogoutPageCtrl($state,$sessionStorage,BBModel,AdminCoreOptions,bbWidgetUtilities,AdminSsoLogin){function performDefaultLogoutAction(){BBModel.Admin.Login.$logout().then(function(){$sessionStorage.removeItem("user"),$sessionStorage.removeItem("auth_token"),$sessionStorage.removeItem("multiLocationUser"),AdminSsoLogin.ssoToken=null,AdminSsoLogin.companyId=null,redirectToLogoutUrlIfDetected()})}function redirectToLogoutUrlIfDetected(){AdminCoreOptions.onLogoutRedirectionURL?bbWidgetUtilities.redirectTo(AdminCoreOptions.onLogoutRedirectionURL):goToStudioLoginPage()}function goToStudioLoginPage(){$state.go("login",{},{reload:!0})}!function(){BBModel.Admin.Login.$isLoggedIn().then(function(){return performDefaultLogoutAction()},function(){return redirectToLogoutUrlIfDetected()})}()}angular.module("BBAdminDashboard.calendar.controllers",[]),angular.module("BBAdminDashboard.calendar.services",[]),angular.module("BBAdminDashboard.calendar.directives",[]),angular.module("BBAdminDashboard.calendar.translations",[]),angular.module("BBAdminDashboard.calendar",["BBAdminDashboard.calendar.controllers","BBAdminDashboard.calendar.services","BBAdminDashboard.calendar.directives","BBAdminDashboard.calendar.translations"]),angular.module("BBAdminDashboard.check-in.controllers",[]),angular.module("BBAdminDashboard.check-in.services",[]),angular.module("BBAdminDashboard.check-in.directives",[]),angular.module("BBAdminDashboard.check-in.translations",[]),angular.module("BBAdminDashboard.check-in",["BBAdminDashboard.check-in.controllers","BBAdminDashboard.check-in.services","BBAdminDashboard.check-in.directives","BBAdminDashboard.check-in.translations"]),angular.module("BBAdminDashboard.clients.controllers",[]),angular.module("BBAdminDashboard.clients.services",[]),angular.module("BBAdminDashboard.clients.directives",[]),angular.module("BBAdminDashboard.clients.translations",[]),angular.module("BBAdminDashboard.clients",["BBAdminDashboard.clients.controllers","BBAdminDashboard.clients.services","BBAdminDashboard.clients.directives","BBAdminDashboard.clients.translations"]),angular.module("BBAdminDashboard.config-iframe.controllers",[]),angular.module("BBAdminDashboard.config-iframe.services",[]),angular.module("BBAdminDashboard.config-iframe.directives",[]),angular.module("BBAdminDashboard.config-iframe.translations",[]),angular.module("BBAdminDashboard.config-iframe",["BBAdminDashboard.config-iframe.controllers","BBAdminDashboard.config-iframe.services","BBAdminDashboard.config-iframe.directives","BBAdminDashboard.config-iframe.translations"]),angular.module("BBAdminDashboard",["ngStorage","ngResource","ngTouch","ngSanitize","ngLocalData","ngCookies","ngMessages","BBAdmin","BBAdminServices","BBAdminBooking","BBAdmin.Directives","BBMember","ui.calendar","ui.bootstrap","ui.router","ct.ui.router.extras","trNgGrid","toggle-switch","pascalprecht.translate","angular-loading-bar","ngScrollable","toastr","BBAdminDashboard.check-in","BBAdminDashboard.clients","BBAdminDashboard.login","BBAdminDashboard.logout","BBAdminDashboard.reset-password","BBAdminDashboard.calendar","BBAdminDashboard.dashboard-iframe","BBAdminDashboard.members-iframe","BBAdminDashboard.settings-iframe","BBAdminDashboard.config-iframe","BBAdminDashboard.publish-iframe"]),angular.module("BBAdminDashboard.dashboard-iframe.controllers",[]),angular.module("BBAdminDashboard.dashboard-iframe.services",[]),angular.module("BBAdminDashboard.dashboard-iframe.directives",[]),angular.module("BBAdminDashboard.dashboard-iframe.translations",[]),angular.module("BBAdminDashboard.dashboard-iframe",["BBAdminDashboard.dashboard-iframe.controllers","BBAdminDashboard.dashboard-iframe.services","BBAdminDashboard.dashboard-iframe.directives","BBAdminDashboard.dashboard-iframe.translations"]),angular.module("BBAdminDashboard.login.controllers",[]),angular.module("BBAdminDashboard.login.services",[]),angular.module("BBAdminDashboard.login.directives",[]),angular.module("BBAdminDashboard.login.translations",[]),angular.module("BBAdminDashboard.login",["BBAdminDashboard.login.controllers","BBAdminDashboard.login.services","BBAdminDashboard.login.directives","BBAdminDashboard.login.translations"]),angular.module("BBAdminDashboard.logout.controllers",[]),angular.module("BBAdminDashboard.logout.services",[]),angular.module("BBAdminDashboard.logout.directives",[]),angular.module("BBAdminDashboard.logout",["BBAdminDashboard.logout.controllers","BBAdminDashboard.logout.services","BBAdminDashboard.logout.directives"]),angular.module("BBAdminDashboard.members-iframe.controllers",[]),angular.module("BBAdminDashboard.members-iframe.services",[]),angular.module("BBAdminDashboard.members-iframe.directives",[]),angular.module("BBAdminDashboard.members-iframe.translations",[]),angular.module("BBAdminDashboard.members-iframe",["BBAdminDashboard.members-iframe.controllers","BBAdminDashboard.members-iframe.services","BBAdminDashboard.members-iframe.directives","BBAdminDashboard.members-iframe.translations"]),angular.module("BBAdminDashboard.publish-iframe.controllers",[]),angular.module("BBAdminDashboard.publish-iframe.services",[]),angular.module("BBAdminDashboard.publish-iframe.directives",[]),angular.module("BBAdminDashboard.publish-iframe.translations",[]),angular.module("BBAdminDashboard.publish-iframe",["BBAdminDashboard.publish-iframe.controllers","BBAdminDashboard.publish-iframe.services","BBAdminDashboard.publish-iframe.directives","BBAdminDashboard.publish-iframe.translations"]),angular.module("BBAdminDashboard.reset-password",[]),angular.module("BBAdminDashboard.settings-iframe.controllers",[]),angular.module("BBAdminDashboard.settings-iframe.services",[]),angular.module("BBAdminDashboard.settings-iframe.directives",[]),angular.module("BBAdminDashboard.settings-iframe.translations",[]),angular.module("BBAdminDashboard.settings-iframe",["BBAdminDashboard.settings-iframe.controllers","BBAdminDashboard.settings-iframe.services","BBAdminDashboard.settings-iframe.directives","BBAdminDashboard.settings-iframe.translations"]),angular.module("BBAdminDashboard.calendar").run(function(RuntimeStates,AdminCalendarOptions,SideNavigationPartials){"ngInject";AdminCalendarOptions.use_default_states&&RuntimeStates.state("calendar",{parent:AdminCalendarOptions.parent_state,url:"calendar",templateUrl:"calendar/index.html",controller:"CalendarPageCtrl"}).state("calendar.people",{url:"/people/:assets",templateUrl:"calendar/people.html"}).state("calendar.resources",{url:"/resources/:assets",templateUrl:"calendar/resources.html"}),AdminCalendarOptions.show_in_navigation&&SideNavigationPartials.addPartialTemplate("calendar","calendar/nav.html")}),angular.module("BBAdminDashboard.check-in").run(function(RuntimeStates,AdminCheckInOptions,SideNavigationPartials){"ngInject";AdminCheckInOptions.use_default_states&&RuntimeStates.state("checkin",{parent:AdminCheckInOptions.parent_state,url:"check-in",templateUrl:"check-in/index.html",controller:"CheckInPageCtrl"}),AdminCheckInOptions.show_in_navigation&&SideNavigationPartials.addPartialTemplate("check-in","check-in/nav.html")}),angular.module("BBAdminDashboard.clients").run(function(RuntimeStates,AdminClientsOptions,SideNavigationPartials){"ngInject";AdminClientsOptions.use_default_states&&RuntimeStates.state("clients",{parent:AdminClientsOptions.parent_state,url:"clients",templateUrl:"clients/index.html",controller:"ClientsPageCtrl"}).state("clients.new",{url:"/new",templateUrl:"clients/new.html",controller:"ClientsNewPageCtrl"}).state("clients.all",{url:"/all",templateUrl:"clients/listing.html",controller:"ClientsAllPageCtrl"}).state("clients.edit",{url:"/edit/:id",templateUrl:"clients/item.html",resolve:{client:function(company,$stateParams,BBModel){var params={company:company,id:$stateParams.id};return BBModel.Admin.Client.$query(params)}},controller:"ClientsEditPageCtrl"}),AdminClientsOptions.show_in_navigation&&SideNavigationPartials.addPartialTemplate("clients","clients/nav.html")}),angular.module("BBAdminDashboard.config-iframe").run(function(RuntimeStates,AdminConfigIframeOptions,SideNavigationPartials){"ngInject";AdminConfigIframeOptions.use_default_states&&RuntimeStates.state("config",{parent:AdminConfigIframeOptions.parent_state,url:"config",templateUrl:"config-iframe/index.html",controller:"ConfigIframePageCtrl",deepStateRedirect:{default:{state:"config.business.page",params:{path:"person"}}}}).state("config.business",{url:"/business",templateUrl:"core/tabbed-substates-page.html",controller:"ConfigIframeBusinessPageCtrl",deepStateRedirect:{default:{state:"config.business.page",params:{path:"person"}}}}).state("config.business.page",{url:"/page/:path",templateUrl:"core/iframe-page.html",controller:"ConfigSubIframePageCtrl"}).state("config.event-settings",{url:"/event-settings",templateUrl:"core/tabbed-substates-page.html",controller:"ConfigIframeEventSettingsPageCtrl",deepStateRedirect:{default:{state:"config.event-settings.page",params:{path:"sessions/courses"}}}}).state("config.event-settings.page",{url:"/page/:path",templateUrl:"core/iframe-page.html",controller:"ConfigSubIframePageCtrl"}).state("config.promotions",{url:"/promotions",templateUrl:"core/tabbed-substates-page.html",controller:"ConfigIframePromotionsPageCtrl",deepStateRedirect:{default:{state:"config.promotions.page",params:{path:"price/deal/summary"}}}}).state("config.promotions.page",{url:"/page/:path",templateUrl:"core/iframe-page.html",controller:"ConfigSubIframePageCtrl"}).state("config.booking-settings",{url:"/booking-settings",templateUrl:"core/tabbed-substates-page.html",controller:"ConfigIframeBookingSettingsPageCtrl",deepStateRedirect:{default:{state:"config.booking-settings.page",params:{path:"detail_type"}}}}).state("config.booking-settings.page",{url:"/page/:path",templateUrl:"core/iframe-page.html",controller:"ConfigSubIframePageCtrl"}),AdminConfigIframeOptions.show_in_navigation&&SideNavigationPartials.addPartialTemplate("config-iframe","config-iframe/nav.html")}),angular.module("BBAdminDashboard").config(function($logProvider,$httpProvider){"ngInject";$logProvider.debugEnabled(!0),$httpProvider.defaults.withCredentials=!0}),angular.module("BBAdminDashboard").run(function(RuntimeStates,AdminCoreOptions,RuntimeRoutes){"ngInject";RuntimeRoutes.otherwise("/"),RuntimeStates.state("root",{url:"/",templateUrl:"core/layout.html",resolve:{user:function($q,BBModel,$state){var defer=$q.defer();return BBModel.Admin.Login.$user().then(function(user){user||$state.go("login"),defer.resolve(user)}).catch(function(err){defer.reject({reason:"LOGIN_SERVICE_ERROR",error:err})}),defer.promise},company:function(user,$q,BBModel){var defer=$q.defer();return user.$getCompany().then(function(company){company.companies&&company.companies.length>0?defer.reject({reason:"COMPANY_IS_PARENT"}):defer.resolve(company)}).catch(function(err){BBModel.Admin.Login.$logout().then(function(){defer.reject({reason:"GET_COMPANY_ERROR"})}).catch(function(err){defer.reject({reason:"LOGOUT_ERROR"})})}),defer.promise}},controller:"CorePageController",deepStateRedirect:{default:{state:AdminCoreOptions.default_state}}})}),angular.module("BBAdminDashboard.dashboard-iframe").run(function(RuntimeStates,AdminDashboardIframeOptions,SideNavigationPartials){"ngInject";AdminDashboardIframeOptions.use_default_states&&RuntimeStates.state("dashboard",{parent:AdminDashboardIframeOptions.parent_state,url:"dashboard",controller:"DashboardIframePageCtrl",templateUrl:"dashboard-iframe/index.html",deepStateRedirect:{default:{state:"dashboard.page",params:{path:"view/dashboard/index",fixed:!0}}}}).state("dashboard.page",{url:"/page/:path",controller:"DashboardSubIframePageCtrl",templateUrl:"core/iframe-page.html"}),AdminDashboardIframeOptions.show_in_navigation&&SideNavigationPartials.addPartialTemplate("dashboard-iframe","dashboard-iframe/nav.html")}),function(angular){function run(RuntimeStates,AdminLoginOptions){"ngInject";AdminLoginOptions.use_default_states&&RuntimeStates.state("login",{url:"/login",resolve:{user:function($q,BBModel){var defer=$q.defer();return BBModel.Admin.Login.$user().then(function(user){defer.resolve(user)}).catch(function(err){defer.reject({reason:"LOGIN_SERVICE_ERROR",error:err})}),defer.promise}},controller:"LoginPageCtrl",templateUrl:"login/index.html"})}angular.module("BBAdminDashboard.login").run(run)}(angular),angular.module("BBAdminDashboard.logout").config(function($stateProvider,$urlRouterProvider){"ngInject";$stateProvider.state("logout",{url:"/logout",controller:"LogoutPageCtrl"})}),angular.module("BBAdminDashboard.members-iframe").run(function(RuntimeStates,AdminMembersIframeOptions,SideNavigationPartials){"ngInject";AdminMembersIframeOptions.use_default_states&&RuntimeStates.state("members",{parent:AdminMembersIframeOptions.parent_state,url:"members",templateUrl:"members-iframe/index.html",controller:"MembersIframePageCtrl",deepStateRedirect:{default:{state:"members.page",params:{path:"client"}}}}).state("members.page",{url:"/page/:path/:id",templateUrl:"core/boxed-iframe-page.html",controller:"MembersSubIframePageCtrl"}),AdminMembersIframeOptions.show_in_navigation&&SideNavigationPartials.addPartialTemplate("members-iframe","members-iframe/nav.html")}),angular.module("BBAdminDashboard.publish-iframe").run(function(RuntimeStates,AdminPublishIframeOptions,SideNavigationPartials){"ngInject";AdminPublishIframeOptions.use_default_states&&RuntimeStates.state("publish",{parent:AdminPublishIframeOptions.parent_state,url:"publish",templateUrl:"publish-iframe/index.html",controller:"PublishIframePageCtrl",deepStateRedirect:{default:{state:"publish.page",params:{path:"conf/inset/intro"}}}}).state("publish.page",{url:"/page/:path",templateUrl:"core/boxed-iframe-page.html",controller:"PublishSubIframePageCtrl"}),AdminPublishIframeOptions.show_in_navigation&&SideNavigationPartials.addPartialTemplate("publish-iframe","publish-iframe/nav.html")}),angular.module("BBAdminDashboard.reset-password").config(function($stateProvider,$urlRouterProvider){"ngInject";$stateProvider.state("reset-password",{url:"/reset-password",controller:"ResetPasswordPageCtrl",templateUrl:"reset-password/index.html"})}),angular.module("BBAdminDashboard.settings-iframe").run(function(RuntimeStates,AdminSettingsIframeOptions,SideNavigationPartials){"ngInject";AdminSettingsIframeOptions.use_default_states&&RuntimeStates.state("settings",{parent:AdminSettingsIframeOptions.parent_state,url:"settings",templateUrl:"settings-iframe/index.html",deepStateRedirect:{default:{state:"settings.page",params:{path:"company/mycompany"}},params:!0}}).state("settings.page",{url:"/page/:path",templateUrl:"core/boxed-iframe-page.html",controller:"SettingsSubIframePageCtrl"}).state("settings.basic-settings",{url:"/basic-settings",templateUrl:"core/tabbed-substates-page.html",controller:"SettingsIframeBasicSettingsPageCtrl",deepStateRedirect:{default:{state:"settings.basic-settings.page",params:{path:"conf/setting/user_edit"}}}}).state("settings.basic-settings.page",{url:"/page/:path",templateUrl:"core/iframe-page.html",controller:"SettingsSubIframePageCtrl"}).state("settings.advanced-settings",{url:"/advanced-settings",templateUrl:"core/tabbed-substates-page.html",controller:"SettingsIframeAdvancedSettingsPageCtrl",deepStateRedirect:{default:{state:"settings.advanced-settings.page",params:{path:"conf/payment/payment_edit"}}}}).state("settings.advanced-settings.page",{url:"/page/:path",templateUrl:"core/iframe-page.html",controller:"SettingsSubIframePageCtrl"}).state("settings.integrations",{url:"/integrations",templateUrl:"core/tabbed-substates-page.html",controller:"SettingsIframeIntegrationsPageCtrl",deepStateRedirect:{default:{state:"settings.integrations.page",params:{path:"conf/addons/payment"}}}}).state("settings.integrations.page",{url:"/page/:path",templateUrl:"core/iframe-page.html",controller:"SettingsSubIframePageCtrl"}).state("settings.subscription",{url:"/subscription",templateUrl:"core/tabbed-substates-page.html",controller:"SettingsIframeSubscriptionPageCtrl",deepStateRedirect:{default:{state:"settings.subscription.page",params:{path:"subscription/show"}}}}).state("settings.subscription.page",{url:"/page/:path",templateUrl:"core/iframe-page.html",controller:"SettingsSubIframePageCtrl"}),AdminSettingsIframeOptions.show_in_navigation&&SideNavigationPartials.addPartialTemplate("settings-iframe","settings-iframe/nav.html")}),function(){function CalendarDatePickerCtrl(){"ngInject";var _this=this;this.dateFormat="dd/MM/yyyy",this.datePickerOpened=!1,this.openDatePicker=function($event){$event.preventDefault(),_this.datePickerOpened=!0},this.datePickerUpdated=function(){var currentDate=_this.currentDate;_.isDate(_this.currentDate)&&_this.onChangeDate({$event:{date:currentDate}})}}angular.module("BBAdminDashboard.calendar.directives").component("bbCalendarDatePicker",{templateUrl:"calendar/bb_calendar_date_picker.html",bindings:{onChangeDate:"&",currentDate:"<"},controller:CalendarDatePickerCtrl,controllerAs:"$bbCalendarDatePickerCtrl"})}(),function(){function CalendarPageCtrl($log,$scope,$state){"ngInject";var gotToProperState=function(){$scope.bb.company.$has("people")?$state.go("calendar.people"):$scope.bb.company.$has("resources")&&$state.go("calendar.resources")},bindToPusherChannel=function(){var pusherChannel=$scope.company.getPusherChannel("bookings");pusherChannel&&(pusherChannel.bind("create",refetch),pusherChannel.bind("update",refetch),pusherChannel.bind("destroy",refetch))},refetch=_.throttle(function(data){$log.info("== booking push received in bookings == ",data),$scope.$broadcast("refetchBookings",data)},1e3,{leading:!1});!function(){bindToPusherChannel(),"calendar"===$state.current.name&&gotToProperState()}()}angular.module("BBAdminDashboard.calendar.controllers").controller("CalendarPageCtrl",CalendarPageCtrl)}(),function(angular){function bbResourceCalendarController($rootScope,$scope,$state,$attrs,$q,$translate,AdminBookingPopup,AdminCalendarOptions,AdminCompanyService,AdminMoveBookingPopup,BBAssets,BBModel,CalendarEventSources,ColorPalette,Dialog,GeneralOptions,ModalForm,PrePostTime,ProcessAssetsFilter,TitleAssembler,uiCalendarConfig,bbTimeZone,$timeout,CalendarEventRenderer,BBCalendarViewsService,BBAdminCalendarService,DateTimeUtilitiesService){"ngInject";var vm=this,filters=null,company=null,companyServices=[],calendarOptions={};vm.assets=[],vm.selectedResources={selected:[]},vm.currentViewType="fullCalendar",vm.availableViews={},vm.getEventsDebouncer={timeoutMS:600,timeoutPromise:null,extraRequestsAllowed:0};var prepareCalOptions=function(){calendarOptions=$scope.$eval($attrs.bbResourceCalendar),calendarOptions||(calendarOptions={}),calendarOptions.name?vm.calendar_name=calendarOptions.name:vm.calendar_name="resourceCalendar",calendarOptions.cal_slot_duration||(calendarOptions.cal_slot_duration=GeneralOptions.calendar_slot_duration)},applyFilters=function(){filters={requestedAssets:ProcessAssetsFilter($state.params.assets)},vm.showAll=filters.requestedAssets.length<=0},prepareEventSources=function(){vm.eventSources=[{events:getEvents}]},getEvents=function(start,end,timezone,callback){null!==vm.getEventsDebouncer.timeoutPromise&&0===vm.getEventsDebouncer.extraRequestsAllowed&&$timeout.cancel(vm.getEventsDebouncer.timeoutPromise),vm.getEventsDebouncer.extraRequestsAllowed>0&&(vm.getEventsDebouncer.extraRequestsAllowed-=1),vm.getEventsDebouncer.timeoutPromise=$timeout(getEventsTimedOut.bind(null,start,end,timezone,callback),vm.getEventsDebouncer.timeoutMS)},getEventsTimedOut=function(start,end,timezone,callback){end.subtract(1,"second"),bbTimeZone.getDisplayUTCOffset()>bbTimeZone.getCompanyUTCOffset()&&(start=start.clone().subtract(1,"day")),bbTimeZone.getDisplayUTCOffset()<bbTimeZone.getCompanyUTCOffset()&&(end=end.clone().add(1,"day")),vm.loading=!0,getCompanyPromise().then(function(company){var options={labelAssembler:$scope.labelAssembler?$scope.labelAssembler:AdminCalendarOptions.bookings_label_assembler,blockLabelAssembler:$scope.blockLabelAssembler?$scope.blockLabelAssembler:AdminCalendarOptions.block_label_assembler,externalLabelAssembler:$scope.externalLabelAssembler?$scope.externalLabelAssembler:AdminCalendarOptions.external_label_assembler,noCache:!0,showAll:vm.showAll,type:calendarOptions.type,selectedResources:vm.selectedResources.selected,calendarView:uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("getView").type};$scope.model&&(options.showAll=!1,options.selectedResources=[$scope.model]),CalendarEventSources.getAllCalendarEntries(company,start,end,options).then(function(results){vm.loading=!1,vm.calendarLoading=!1,callback(results)})})},selectView=function(view){view!==vm.currentViewType&&(vm.currentViewType=view,vm.switchViewType=!0,prepareUiCalOptions(),uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("refetchEvents"))},prepareUiCalOptions=function(){vm.uiCalOptions={calendar:{editable:!0,schedulerLicenseKey:"0598149132-fcs-1443104297",eventStartEditable:!1,eventDurationEditable:!1,height:"auto",buttonText:{today:$translate.instant("ADMIN_DASHBOARD.CALENDAR_PAGE.TODAY")},customButtons:{fullCalendar:{text:$translate.instant("ADMIN_DASHBOARD.CALENDAR_PAGE.CALENDAR"),click:function(){vm.getEventsDebouncer.extraRequestsAllowed=2,selectView("fullCalendar")}},bbListView:{text:$translate.instant("ADMIN_DASHBOARD.CALENDAR_PAGE.AGENDA"),click:function(){vm.getEventsDebouncer.extraRequestsAllowed=2,selectView("bbListView")}}},header:{left:"today,prev,next",center:"title",right:BBAdminCalendarService.constructViewsString(vm.currentViewType,vm.availableViews)},defaultView:Object.keys(vm.availableViews[vm.currentViewType])[0],views:vm.availableViews[vm.currentViewType],resourceGroupField:"group",resourceLabelText:" ",eventResourceEditable:!0,selectable:!0,lazyFetching:!1,columnFormat:AdminCalendarOptions.column_format,resources:fcResources,eventDragStop:fcEventDragStop,eventDrop:fcEventDrop,eventClick:fcEventClick,eventRender:fcEventRender,eventAfterRender:fcEventAfterRender,eventAfterAllRender:fcEventAfterAllRender,select:fcSelect,viewRender:fcViewRender,eventResize:fcEventResize,loading:fcLoading,ignoreTimezone:!1,timezone:bbTimeZone.getDisplay()}},vm.uiCalOptions.calendar.locale=$translate.use(),updateCalendarTimeRange()},updateCalendarTimeRange=function(){vm.uiCalOptions.calendar.minTime=AdminCalendarOptions.minTime,vm.uiCalOptions.calendar.maxTime=AdminCalendarOptions.maxTime},fcResources=function(callback){return getCalendarAssets(callback)},fcEventDragStop=function(event){event.oldResourceIds=event.resourceIds},fcEventDrop=function(booking,delta,revertFunc){var calendar=uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("getCalendar");booking.start=calendar.moment(bbTimeZone.convertToDisplay(booking.start.toISOString())),booking.end=calendar.moment(bbTimeZone.convertToDisplay(booking.end.toISOString()));var moveModalTitleText=$translate.instant("ADMIN_DASHBOARD.CALENDAR_PAGE.MOVE_MODAL_HEADING"),moveModalBodyText=$translate.instant("ADMIN_DASHBOARD.CALENDAR_PAGE.MOVE_MODAL_BODY");if(3!==booking.status&&(booking.person_id&&booking.resource_id||delta.days()>0)){var start=booking.start,end=booking.end;start=bbTimeZone.convertToCompany(start),end=bbTimeZone.convertToCompany(end);var item_defaults={date:start.format("YYYY-MM-DD"),time:60*start.hour()+start.minute()};if(booking.resourceId){var newAssetId=booking.resourceId.substring(0,booking.resourceId.indexOf("_"));booking.resourceId.indexOf("_p")>-1?item_defaults.person=newAssetId:booking.resourceId.indexOf("_r")>-1&&(item_defaults.resource=newAssetId)}return void Dialog.confirm({title:moveModalTitleText,body:moveModalBodyText,model:booking,success:function(model){getCompanyPromise().then(function(company){return AdminMoveBookingPopup.open({min_date:DateTimeUtilitiesService.setTimeToMoment(start,AdminCalendarOptions.minTime),max_date:DateTimeUtilitiesService.setTimeToMoment(end,AdminCalendarOptions.maxTime),from_datetime:moment(start.toISOString()),to_datetime:moment(end.toISOString()),item_defaults:item_defaults,company_id:company.id,booking_id:booking.id,success:function(model){return updateBooking(model)},fail:function(){return revertFunc()}})})},fail:function(){return revertFunc()}})}Dialog.confirm({title:moveModalTitleText,body:moveModalBodyText,model:booking,success:function(model){return booking.start=bbTimeZone.convertToCompany(booking.start),booking.end=bbTimeZone.convertToCompany(booking.end),updateBooking(booking)},fail:function(){return revertFunc()}})},fcEventClick=function(booking){"external"!==booking.type&&booking.$has("edit")&&editBooking(new BBModel.Admin.Booking(booking))},fcEventRender=function(booking,element){var _uiCalendarConfig$cal=uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("getView"),type=_uiCalendarConfig$cal.type,service=companyServices.find(function(companyService){return companyService.id===booking.service_id});return $scope.model||("listDay"===type?CalendarEventRenderer.renderListDayEvents(booking,element,calendarOptions):"agendaWeek"!==type&&"month"!==type||CalendarEventRenderer.renderNonListDayEvents(booking,element,calendarOptions)),service&&!["listDay","bbListDay","bbListWeek","bbListMonth"].includes(type)&&(element.css("background-color",service.color),element.css("color",service.textColor),element.css("border-color",service.textColor)),element},fcEventAfterRender=function(event,elements,view){if(null==event.rendering||"background"!==event.rendering)return PrePostTime.apply(event,elements,view,$scope)},fcEventAfterAllRender=function(view){var fcInstance=uiCalendarConfig.calendars[vm.calendar_name],titleContainer=fcInstance.find(".fc-center");(titleContainer.find("h1")[0]||titleContainer.find("h2")[0])&&titleContainer.replaceWith('<div class="fc-center"><h1 tabindex="0">'+view.title+"</h1></div>"),$scope.$emit("UICalendar:EventAfterAllRender")},openWidgetModal=function(item_defaults,start,end,title){getCompanyPromise().then(function(company){return AdminBookingPopup.open({min_date:DateTimeUtilitiesService.setTimeToMoment(start,AdminCalendarOptions.minTime),max_date:DateTimeUtilitiesService.setTimeToMoment(end,AdminCalendarOptions.maxTime),from_datetime:moment(start.toISOString()),to_datetime:moment(end.toISOString()),first_page:"quick_pick",on_conflict:"cancel()",company_id:company.id,title:title,item_defaults:item_defaults})})},fcSelect=function(start,end,jsEvent,view,resource){var modalTitle=void 0,item_defaults=void 0;if(!jsEvent||"fc-scroller"!==jsEvent.target.className){var calendar=uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("getCalendar"),startTimeCompanyTimezone=calendar.moment(bbTimeZone.convertToCompany(moment(start.toISOString()))),endTimeCompanyTimezone=calendar.moment(bbTimeZone.convertToCompany(moment(end.toISOString())));if("month"===view.type)return modalTitle=start.format(AdminCalendarOptions.monthTitleFormat),item_defaults={date:startTimeCompanyTimezone.format("YYYY-MM-DD")},openWidgetModal(item_defaults,startTimeCompanyTimezone,endTimeCompanyTimezone,modalTitle);if(modalTitle=start.format("LLLL"),view.calendar.unselect(),"agendaWeek"===view.type)return item_defaults={date:startTimeCompanyTimezone.format("YYYY-MM-DD"),time:60*startTimeCompanyTimezone.hour()+startTimeCompanyTimezone.minute()},openWidgetModal(item_defaults,startTimeCompanyTimezone,endTimeCompanyTimezone,modalTitle);(!calendarOptions.enforce_schedules||isTimeRangeAvailable(startTimeCompanyTimezone,endTimeCompanyTimezone,resource)||1===Math.abs(startTimeCompanyTimezone.diff(endTimeCompanyTimezone,"days"))&&dayHasAvailability(startTimeCompanyTimezone))&&makeSelectionDayView(startTimeCompanyTimezone,endTimeCompanyTimezone,item_defaults,resource,modalTitle)}},makeSelectionDayView=function(startTimeCompanyTimezone,endTimeCompanyTimezone,item_defaults,resource,modalTitle){Math.abs(startTimeCompanyTimezone.diff(endTimeCompanyTimezone,"days"))>0&&(endTimeCompanyTimezone.subtract(1,"days"),endTimeCompanyTimezone=DateTimeUtilitiesService.setTimeToMoment(endTimeCompanyTimezone,AdminCalendarOptions.maxTime)),item_defaults={date:startTimeCompanyTimezone.format("YYYY-MM-DD"),time:60*startTimeCompanyTimezone.hour()+startTimeCompanyTimezone.minute()},resource&&"person"===resource.type?item_defaults.person=resource.id.substring(0,resource.id.indexOf("_")):resource&&"resource"===resource.type&&(item_defaults.resource=resource.id.substring(0,resource.id.indexOf("_"))),openWidgetModal(item_defaults,startTimeCompanyTimezone,endTimeCompanyTimezone,modalTitle)},fcViewRender=function(view,element){var activeBtn=$(".fc-"+vm.currentViewType+"-button");activeBtn.addClass("fc-state-active"),vm.switchViewType&&(activeBtn.focus(),vm.switchViewType=!1),$(".fc-prev-button").attr("aria-label",$translate.instant("ADMIN_DASHBOARD.CALENDAR_PAGE.PREVIOUS")),$(".fc-next-button").attr("aria-label",$translate.instant("ADMIN_DASHBOARD.CALENDAR_PAGE.NEXT"));var date=uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("getDate"),formattedDate=moment().tz(moment.tz.guess());return formattedDate.set({year:parseInt(date.get("year")),month:parseInt(date.get("month")),date:parseInt(date.get("date")),hour:0,minute:0,second:0}),vm.currentDate=formattedDate.toDate()},fcEventResize=function(booking){return booking.duration=booking.end.diff(booking.start,"minutes"),updateBooking(booking)},fcLoading=function(isLoading){vm.calendarLoading=isLoading},isTimeRangeAvailable=function(start,end,resource){var st=moment(start.toISOString()).unix(),en=moment(end.toISOString()).unix();return uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("clientEvents",function(event){return"background"===event.rendering&&st>=event.start.unix()&&event.end&&en<=event.end.unix()&&(resource&&parseInt(event.resourceId)===parseInt(resource.id)||!resource)}).length>0},dayHasAvailability=function(start){return uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("clientEvents",function(event){return"background"===event.rendering&&event.start.year()===start.year()&&event.start.month()===start.month()&&event.start.date()===start.date()}).length>0},selectedResourcesListener=function(newValue,oldValue){if(newValue!==oldValue){var assets=[];angular.forEach(newValue,function(asset){return assets.push(asset.id)});var params=$state.params;params.assets=assets.join(),$state.go($state.current.name,params,{notify:!1,reload:!1})}},getCalendarAssets=function(callback){if($scope.model)return void callback([$scope.model]);vm.loading=!0,getCompanyPromise().then(function(company){vm.showAll?BBAssets.getAssets(company).then(function(assets){calendarOptions.type&&(assets=_.filter(assets,function(a){return a.type===calendarOptions.type}));var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=Array.from(assets)[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var asset=_step.value;asset.id=asset.identifier}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return vm.loading=!1,callback(assets)}):(vm.loading=!1,callback(vm.selectedResources.selected))})},getBookingTitle=function(booking){var labelAssembler=$scope.labelAssembler?$scope.labelAssembler:AdminCalendarOptions.bookings_label_assembler,blockLabelAssembler=$scope.blockLabelAssembler?$scope.blockLabelAssembler:AdminCalendarOptions.block_label_assembler
;return 3!==booking.status&&labelAssembler?TitleAssembler.getTitle(booking,labelAssembler):3===booking.status&&blockLabelAssembler?TitleAssembler.getTitle(booking,blockLabelAssembler):booking.title},refreshBooking=function(booking){booking.$refetch().then(function(response){booking.resourceIds=[],booking.resourceId=null,null!=booking.person_id&&booking.resourceIds.push(booking.person_id+"_p"),null!=booking.resource_id&&booking.resourceIds.push(booking.resource_id+"_r"),booking.title=getBookingTitle(booking),uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("updateEvent",booking)})},updateBooking=function(booking){if(booking.resourceId){var newAssetId=booking.resourceId.substring(0,booking.resourceId.indexOf("_"));booking.resourceId.indexOf("_p")>-1?booking.person_id=newAssetId:booking.resourceId.indexOf("_r")>-1&&(booking.resource_id=newAssetId)}booking.$update().then(function(){booking.resourceIds=[],booking.resourceId=null,null!=booking.person_id&&booking.resourceIds.push(booking.person_id+"_p"),null!=booking.resource_id&&booking.resourceIds.push(booking.resource_id+"_r"),booking.title=getBookingTitle(booking),booking.start=bbTimeZone.convertToDisplay(booking.start),booking.end=bbTimeZone.convertToDisplay(booking.end),uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("updateEvent",booking)})},editBooking=function(booking){var templateUrl=void 0,title=void 0,size=void 0;3===booking.status?(templateUrl="edit_block_modal_form.html",title=$translate.instant("CORE.MODAL.EDIT_BLOCK"),size="lg"):(templateUrl="edit_booking_modal_form.html",size="md",title=$translate.instant("CORE.MODAL.EDIT_BOOKING")),booking.min_date=DateTimeUtilitiesService.setTimeToMoment(booking.start,AdminCalendarOptions.minTime),booking.max_date=DateTimeUtilitiesService.setTimeToMoment(booking.end,AdminCalendarOptions.maxTime),booking.from_datetime=moment(booking.start.toISOString()),booking.to_datetime=moment(booking.end.toISOString()),ModalForm.edit({templateUrl:templateUrl,size:size,model:booking,title:title,params:{locale:$translate.use()},success:function(response){if("string"==typeof response){if("move"===response){var item_defaults={person:booking.person_id,resource:booking.resource_id,slot:{time:booking.time}};getCompanyPromise().then(function(company){return AdminMoveBookingPopup.open({item_defaults:item_defaults,company_id:company.id,booking_id:booking.id,success:function(){return refreshBooking(booking)},fail:function(){return refreshBooking(booking)}})})}}else response.is_cancelled?uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("removeEvents",[response.id]):(booking.title=getBookingTitle(booking),uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("updateEvent",booking),uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("refetchEvents"))}})},pusherBooking=function(res){if(null!=res.id){var booking=_.first(uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("clientEvents",res.id));booking&&booking.$refetch?booking.$refetch().then(function(){booking.title=getBookingTitle(booking),uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("updateEvent",booking)}):uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("refetchEvents")}},pusherSubscribe=function(){if(company){var pusherChannel=company.getPusherChannel("bookings");pusherChannel&&(pusherChannel.bind("create",pusherBooking),pusherChannel.bind("update",pusherBooking),pusherChannel.bind("destroy",pusherBooking))}},updateDateHandler=function(data){if(uiCalendarConfig.calendars[vm.calendar_name]){var assembledDate=moment.utc();assembledDate.set({year:parseInt(data.date.getFullYear()),month:parseInt(data.date.getMonth()),date:parseInt(data.date.getDate()),hour:0,minute:0,second:0}),uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("gotoDate",assembledDate)}},refetchBookingsHandler=function(){uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("refetchEvents")},newCheckoutHandler=function(){uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("refetchEvents")},timeZoneChangedHandler=function(event,tz){uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("option","timezone",tz)},timeRangeChangedHandler=function(){updateCalendarTimeRange()},getCompanyPromise=function(){var defer=$q.defer();return company?defer.resolve(company):AdminCompanyService.query($attrs).then(function(_company){company=_company,defer.resolve(company)}),defer.promise},changeSelectedResources=function(){vm.showAll&&(vm.selectedResources.selected=[]),uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("refetchResources"),uiCalendarConfig.calendars[vm.calendar_name].fullCalendar("refetchEvents")},assetsListener=function(assets){var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=Array.from(assets)[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var asset=_step2.value;asset.id=asset.identifier}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}vm.loading=!1,calendarOptions.type&&(assets=_.filter(assets,function(a){return a.type===calendarOptions.type})),vm.assets=assets,filters.requestedAssets.length>0&&(angular.forEach(vm.assets,function(asset){if(void 0!==_.find(filters.requestedAssets,function(id){return id===asset.id}))return vm.selectedResources.selected.push(asset)}),changeSelectedResources())},companyListener=function(company){vm.loading=!0,BBAssets.getAssets(company).then(assetsListener),company.$get("services").then(collectionListener),pusherSubscribe()},collectionListener=function(collection){collection.$get("services").then(servicesListener)},servicesListener=function(services){companyServices=Array.from(services).map(function(service){return new BBModel.Admin.Service(service)}),ColorPalette.setColors(companyServices)};!function(){BBCalendarViewsService.addCustomViewsToCalendar(),applyFilters(),prepareCalOptions(),vm.availableViews=BBAdminCalendarService.prepareViewsConfig(calendarOptions),prepareEventSources(),prepareUiCalOptions(),$scope.$watch("selectedResources.selected",selectedResourcesListener),$scope.$on("refetchBookings",refetchBookingsHandler),$scope.$on("newCheckout",newCheckoutHandler),$scope.$on("CalendarEventSources:timeRangeChanged",timeRangeChangedHandler),$rootScope.$on("BBTimeZoneOptions:timeZoneChanged",timeZoneChangedHandler),getCompanyPromise().then(companyListener),vm.changeSelectedResources=changeSelectedResources,vm.updateDateHandler=updateDateHandler}()}angular.module("BBAdminDashboard.calendar.controllers").controller("bbResourceCalendarController",bbResourceCalendarController)}(angular),function(angular){function bbResourceCalendarDirective($compile){"ngInject";function link(scope,element,attrs){var addDatePickerToFCToolbar=function(){var uiCalElement=angular.element(document.getElementById("uicalendar"));if(!uiCalElement.find("bb-calendar-date-picker").length){var toolbarElement=angular.element(uiCalElement.children()[0]),toolbarLeftElement=angular.element(toolbarElement.children()[0]),datePickerElement=$compile('<bb-calendar-date-picker on-change-date="vm.updateDateHandler($event)" current-date="vm.currentDate"></bb-calendar-date-picker>')(scope);toolbarLeftElement.append(datePickerElement)}};!function(){scope.$on("UICalendar:EventAfterAllRender",addDatePickerToFCToolbar)}()}return{controller:"bbResourceCalendarController",controllerAs:"vm",link:link,templateUrl:"calendar/resource-calendar.html",replace:!0,scope:{labelAssembler:"@",blockLabelAssembler:"@",externalLabelAssembler:"@",model:"=?"}}}angular.module("BBAdminDashboard.calendar.directives").directive("bbResourceCalendar",bbResourceCalendarDirective)}(angular);var BBAdminCalendarService=function(){function BBAdminCalendarService($translate,$filter){"ngInject";_classCallCheck(this,BBAdminCalendarService),this.$translate=$translate,this.$filter=$filter}return BBAdminCalendarService.prototype.prepareViewsConfig=function(calendarOptions){if(!calendarOptions)throw new Error("Please provide calendar options to initialise the views.");if(!calendarOptions.cal_slot_duration)throw new Error("cal_slot_duration is required to initialise the views: "+calendarOptions);return{fullCalendar:{timelineDay:{buttonText:this.$translate.instant("ADMIN_DASHBOARD.CALENDAR_PAGE.DAY"),slotDuration:this.$filter("minutesToString")(calendarOptions.cal_slot_duration),eventOverlap:!1,slotWidth:25,resourceAreaWidth:"18%"},agendaWeek:{buttonText:this.$translate.instant("ADMIN_DASHBOARD.CALENDAR_PAGE.WEEK"),slotDuration:this.$filter("minutesToString")(calendarOptions.cal_slot_duration),groupByDateAndResource:!1},month:{buttonText:this.$translate.instant("ADMIN_DASHBOARD.CALENDAR_PAGE.MONTH"),eventLimit:5}},bbListView:{bbListDay:{buttonText:this.$translate.instant("ADMIN_DASHBOARD.CALENDAR_PAGE.DAY"),type:"bbListView"},bbListWeek:{buttonText:this.$translate.instant("ADMIN_DASHBOARD.CALENDAR_PAGE.WEEK"),type:"bbListView",duration:{weeks:1}},bbListMonth:{buttonText:this.$translate.instant("ADMIN_DASHBOARD.CALENDAR_PAGE.MONTH"),type:"bbListView",duration:{months:1}}}}},BBAdminCalendarService.prototype.constructViewsString=function(currentViewType,availableViews){if("string"!=typeof currentViewType)throw new TypeError("Please provide a view type string: "+currentViewType);if(!availableViews)throw new Error("Please provide valid view definition objects: "+availableViews);var views=availableViews[currentViewType];if(!views)throw new Error(currentViewType+" is not in the available views: "+availableViews);var viewsString="";Object.keys(availableViews).forEach(function(viewType){return viewsString+=viewType+","}),viewsString=viewsString.substr(0,viewsString.length-1)+" ";for(var viewName in views)viewsString+=viewName+",";return viewsString.substr(0,viewsString.length-1)},BBAdminCalendarService}();angular.module("BBAdminDashboard.calendar.services").service("BBAdminCalendarService",BBAdminCalendarService),angular.module("BBAdminDashboard.calendar.services").provider("AdminCalendarOptions",[function(){var options={use_default_states:!0,show_in_navigation:!0,parent_state:"root",column_format:null,bookings_label_assembler:"{service_name} - {client_name}",block_label_assembler:"Blocked",external_label_assembler:"{title}",minTime:null,maxTime:null,monthTitleFormat:"dddd, Do MMMM YYYY"};this.setOption=function(option,value){options.hasOwnProperty(option)&&(options[option]=value)},this.getOption=function(option){if(options.hasOwnProperty(option))return options[option]},this.$get=function(){return options}}]);var BBCalendarViewsService=function(){function BBCalendarViewsService($translate){"ngInject";_classCallCheck(this,BBCalendarViewsService),this.$translate=$translate}return BBCalendarViewsService.prototype.addCustomViewsToCalendar=function(){var listView=new BBListView;$.fullCalendar.views.bbListView={class:listView.fullCalendarClass,buttonTextKey:"bbListView",defaults:{buttonText:"bbListView",listDayFormat:"LL",noEventsMessage:this.$translate.instant("ADMIN_DASHBOARD.CALENDAR_PAGE.NO_EVENTS")}}},BBCalendarViewsService}();angular.module("BBAdminDashboard.calendar").service("BBCalendarViewsService",BBCalendarViewsService);var BBListView=function BBListView(){_classCallCheck(this,BBListView),this.FC=$.fullCalendar,this.FCGrid=this.FC.Grid,this.view=this.FC.View;var Scroller=this.FC.Scroller,self=this;this.fullCalendarClass=this.view.extend({grid:null,scroller:null,subtractInnerElHeight:function(outerEl,innerEl){var diff,both=outerEl.add(innerEl);return both.css({position:"relative",left:-1}),diff=outerEl.outerHeight()-innerEl.outerHeight(),both.css({position:"",left:""}),diff},initialize:function(){this.grid=new ListViewGrid(this),this.scroller=new Scroller({overflowX:"hidden",overflowY:"auto"})},renderSkeleton:function(){this.el.addClass("fc-list-view "+this.widgetContentClass),this.scroller.render(),this.scroller.el.appendTo(this.el),this.grid.setElement(this.scroller.scrollEl)},unrenderSkeleton:function(){this.scroller.destroy()},setHeight:function(totalHeight,isAuto){this.scroller.setHeight(this.computeScrollerHeight(totalHeight))},computeScrollerHeight:function(totalHeight){return totalHeight-this.subtractInnerElHeight(this.el,this.scroller.el)},renderDates:function(){this.grid.setRange(this)},renderEvents:function(events){this.grid.renderEvents(events)},unrenderEvents:function(){this.grid.unrenderEvents()},isEventResizable:function(event){return!1},isEventDraggable:function(event){return!1}});var ListViewGrid=this.FCGrid.extend({segSelector:".fc-list-item",hasDayInteractions:!1,spanToSegs:function(span){for(var dayStart=this.start.clone().time(0),dayIndex=0,seg=void 0,segs=[];dayStart<this.end;)if(seg=self.FC.intersectRanges(span,{start:dayStart,end:dayStart.clone().add(1,"day")}),seg&&(seg.dayIndex=dayIndex,segs.push(seg)),dayStart.add(1,"day"),dayIndex++,seg&&!seg.isEnd&&span.end.hasTime()&&span.end<dayStart.clone().add(this.view.nextDayThreshold)){seg.end=span.end.clone(),seg.isEnd=!0;break}return segs},computeEventTimeFormat:function(){return this.view.opt("mediumTimeFormat")},handleSegClick:function(seg,ev){var url=void 0;self.FCGrid.prototype.handleSegClick.apply(this,arguments),$(ev.target).closest("a[href]").length||(url=seg.event.url)&&!ev.isDefaultPrevented()&&(window.location.href=url)},renderFgSegs:function(segs){return segs=this.renderFgSegEls(segs),segs.length?this.renderSegList(segs):this.renderEmptyMessage(),segs},renderEmptyMessage:function(){this.el.html('<div class="fc-list-empty-wrap2"><div class="fc-list-empty-wrap1"><div class="fc-list-empty">'+self.FC.htmlEscape(this.view.opt("noEventsMessage"))+"</div></div></div>")},renderSegList:function(allSegs){var _this=this,segsByDay=this.groupSegsByDay(allSegs),dayTables=[],i=0,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=segsByDay[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var day=_step.value,tableEl=$('<table class="fc-list-table"><thead/><tbody/></table>'),tHeadEl=tableEl.find("thead"),tbodyEl=tableEl.find("tbody");if(day){tHeadEl.append(this.dayHeaderHtml(this.start.clone().add(i,"days"))),i++,this.sortEventSegs(day);var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=day[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0)!function(){var listItem=_step2.value;tbodyEl.append(listItem.el),listItem.el.on("keypress",function(e){_this.view.trigger("eventClick",listItem.el[0],listItem.event,"keydown")})}()}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}dayTables.push(tableEl)}else i++}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}this.el.empty(),dayTables.forEach(function(dayTable){return _this.el.append(dayTable)})},groupSegsByDay:function(segs){var segsByDay=[],i=void 0,seg=void 0;for(i=0;i<segs.length;i++)seg=segs[i],(segsByDay[seg.dayIndex]||(segsByDay[seg.dayIndex]=[])).push(seg);return segsByDay},dayHeaderHtml:function(dayDate){var view=this.view;return'<tr tabindex="0" class="fc-list-heading" data-date="'+dayDate.format("YYYY-MM-DD")+'"><th class="'+view.widgetHeaderClass+'" colspan="3"><h2>'+view.buildGotoAnchorHtml(dayDate,{class:"fc-list-heading-main"},self.FC.htmlEscape(dayDate.format("LL")))+"</h2></th></tr>"},fgSegHtml:function(seg){var classes=["fc-list-item"].concat(this.getSegCustomClasses(seg)),bgColor=this.getSegBackgroundColor(seg),event=seg.event,url=event.url,timeHtml=void 0;return timeHtml=event.allDay?this.view.getAllDayHtml():this.view.isMultiDayEvent(event)?seg.isStart||seg.isEnd?self.FC.htmlEscape(this.getEventTimeText(seg)):this.view.getAllDayHtml():self.FC.htmlEscape(this.getEventTimeText(event)),url&&classes.push("fc-has-url"),'<tr role="button" style="{margin-top: 30px}" tabindex="0" class="'+classes.join(" ")+'">'+(this.displayEventTime?'<td class="fc-list-item-time '+this.view.widgetContentClass+'">'+(timeHtml||"")+"</td>":"")+'<td class="fc-list-item-marker '+this.view.widgetContentClass+'"><span class="fc-event-dot"'+(bgColor?' style="background-color:'+bgColor+'"':"")+'></span></td><td class="fc-list-item-title '+this.view.widgetContentClass+'"><a'+(url?' href="'+self.FC.htmlEscape(url)+'"':"")+">"+self.FC.htmlEscape(seg.event.title||"")+"</a></td></tr>"}})};!function(){function calendarEventRenderer($bbug,uiCalendarConfig){"ngInject";return{renderListDayEvents:function(booking,element,calOptions){var a=void 0,link=void 0;(link=$bbug(element.children()[2]))&&(a=link.children()[0])&&(!booking.person_name||calOptions.type&&"person"!==calOptions.type?booking.resource_name&&"resource"===calOptions.type&&(a.innerHTML=booking.resource_name+" - "+a.innerHTML):a.innerHTML=booking.person_name+" - "+a.innerHTML)},renderNonListDayEvents:function(booking,element,calOptions){var a=void 0,link=void 0;(link=$bbug(element.children()[0]))&&(a=link.children()[1])&&(!booking.person_name||calOptions.type&&"person"!==calOptions.type?booking.resource_name&&"resource"===calOptions.type&&(a.innerHTML=booking.resource_name+"<br/>"+a.innerHTML):a.innerHTML=booking.person_name+"<br/>"+a.innerHTML)}}}angular.module("BBAdminDashboard.calendar").factory("CalendarEventRenderer",calendarEventRenderer)}(),angular.module("BBAdminDashboard.calendar.services").service("CalendarEventSources",function(AdminScheduleService,BBModel,$q,$log,TitleAssembler,$translate,AdminCalendarOptions,$rootScope,bbTimeZone,GeneralOptions){"ngInject";var bookingBelongsToSelectedResources=function(resources,booking){var belongs=!1;return _.each(resources,function(asset){if(_.contains(booking.resourceIds,asset.id))return belongs=!0}),belongs},getBookingsAndBlocks=function(company,start,end,options){null==options&&(options={});var deferred=$q.defer(),params={company:company,start_date:start.format("YYYY-MM-DD"),end_date:end.format("YYYY-MM-DD"),skip_cache:!(null==options.noCache||!options.noCache)};return BBModel.Admin.Booking.$query(params).then(function(bookings){var filteredBookings=[];return bookings.items.map(function(booking){booking.service_name=$translate.instant(booking.service_name,null,null,null,null),booking.resourceIds=[],null!=booking.person_id&&booking.resourceIds.push(booking.person_id+"_p"),null!=booking.resource_id&&booking.resourceIds.push(booking.resource_id+"_r"),(null==options.showAll||null!=options.showAll&&options.showAll||bookingBelongsToSelectedResources(options.selectedResources,booking))&&(booking.useFullTime(),booking.$has("edit")&&(booking.startEditable=!0),3!==booking.status&&null!=options.labelAssembler?booking.title=TitleAssembler.getTitle(booking,options.labelAssembler):3===booking.status&&null!=options.blockLabelAssembler&&(booking.title=TitleAssembler.getTitle(booking,options.blockLabelAssembler)),(!options.type||"resource"===options.type&&booking.resource_id||"person"===options.type&&booking.person_id)&&filteredBookings.push(booking))}),deferred.resolve(filteredBookings)},function(err){return deferred.reject(err)}),deferred.promise},getExternalBookings=function(company,start,end,options){null==options&&(options={});var deferred=$q.defer();if(company.$has("external_bookings")){var params={start:start.format(),end:end.format(),no_cache:!(null==options.noCache||!options.noCache)};company.$get("external_bookings",params).then(function(collection){var bookings=collection.external_bookings;return bookings?(bookings.map(function(booking){booking.resourceIds=[],null!=booking.person_id&&booking.resourceIds.push(booking.person_id+"_p"),null!=booking.resource_id&&booking.resourceIds.push(booking.resource_id+"_r"),booking.title||(booking.title="Blocked"),null!=options.externalLabelAssembler&&(booking.title=TitleAssembler.getTitle(booking,options.externalLabelAssembler)),booking.className="status_external",booking.type="external",booking.editable=!1,booking.startEditable=!1,booking.durationEditable=!1,booking.resourceEditable=!1}),deferred.resolve(bookings)):deferred.resolve([])},function(err){return deferred.reject(err)})}else deferred.resolve([]);return deferred.promise},getAvailabilityBackground=function(company,start,end,options){null==options&&(options={});var deferred=$q.defer();return AdminScheduleService.getAssetsScheduleEvents(company,start,end,!options.showAll,options.selectedResources).then(function(availabilities){if(null!=AdminCalendarOptions.minTime&&null!=AdminCalendarOptions.maxTime||setCalendarAvailabilityRange(availabilities),"timelineDay"===options.calendarView)return deferred.resolve(availabilities);var overAllAvailabilities=[];availabilities.map(function(avail){avail.unix_start=moment(avail.start).unix(),avail.unix_end=moment(avail.end).unix(),avail.delete_me=!1});for(var sorted=_.sortBy(availabilities,function(x){return moment(x.start).unix()}),id=0,testId=1;testId<sorted.length;){var src=sorted[id],test=sorted[testId];src.delete_me?(id+=1,testId=id+1):test.unix_end>src.unix_end&&test.unix_start<src.unix_end?(src.end=test.end,src.unix_end=test.unix_end,test.delete_me=!0,testId+=1):test.unix_end<=src.unix_end?(test.delete_me=!0,testId+=1):(id+=1,testId+=1)}return sorted.map(function(availability){availability.delete_me||overAllAvailabilities.push({start:availability.start,end:availability.end,rendering:"background",title:"Joined availability "+moment(availability.start).format("YYYY-MM-DD"),allDay:"month"===options.calendarView})}),deferred.resolve(overAllAvailabilities)},function(err){return deferred.reject(err)}),deferred.promise},setCalendarAvailabilityRange=function(availabilities){var maxTime=void 0,minTime=void 0;if(0!==availabilities.length){for(var index=0;index<availabilities.length;index++){var availability=availabilities[index];(availability.start.isBefore(minTime)||0===index)&&(minTime=availability.start),(availability.end.isAfter(maxTime)||0===index)&&(maxTime=availability.end)}minTime=bbTimeZone.convertToCompany(minTime),maxTime=bbTimeZone.convertToCompany(maxTime),AdminCalendarOptions.minTime=minTime.format("HH:mm"),AdminCalendarOptions.maxTime=maxTime.format("HH:mm"),guardMidnightFormat(minTime,maxTime),$rootScope.$broadcast("CalendarEventSources:timeRangeChanged")}},guardMidnightFormat=function(minTime,maxTime){minTime.isSame(maxTime,"day")||"00:00"!==AdminCalendarOptions.maxTime||(AdminCalendarOptions.maxTime="24:00")};return{getBookingsAndBlocks:getBookingsAndBlocks,getExternalBookings:getExternalBookings,getAvailabilityBackground:getAvailabilityBackground,getAllCalendarEntries:function(company,start,end,options){null==options&&(options={});var deferred=$q.defer(),promises=[getBookingsAndBlocks(company,start,end,options),getAvailabilityBackground(company,start,end,options)];return GeneralOptions.companyHasExternalBookings&&promises.push(getExternalBookings(company,start,end,options)),$q.all(promises).then(function(resolutions){var allResults=[];angular.forEach(resolutions,function(results,index){return allResults=allResults.concat(results)}),deferred.resolve(allResults)},function(err){$log.info(err),deferred.reject(err)}),deferred.promise}}}),angular.module("BBAdminDashboard.calendar.services").factory("PrePostTime",function($compile){return{apply:function(event,elements,view,scope){return function(){var result=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=Array.from(elements)[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var e=_step.value,item=void 0,element=angular.element(e),totalDuration=event.duration+event.pre_time+event.post_time;if(event.pre_time)switch(view.name){case"agendaWeek":case"agendaDay":var preHeight=event.pre_time*(element.height()+2)/totalDuration,pre=$compile("<div class='pre' style='height:"+preHeight+"px'></div>")(scope);element.prepend(pre);break;case"timelineDay":var contentDiv=element.children()[0],preWidth=event.pre_time*(element.width()+2)/totalDuration,_pre=$compile("<div class='pre' style='width:"+preWidth+"px'></div>")(scope);element.prepend(_pre),angular.element(contentDiv).css("padding-left",preWidth+"px")}if(event.post_time)switch(view.name){case"agendaWeek":case"agendaDay":var postHeight=event.post_time*(element.height()+2)/totalDuration,post=$compile("<div class='post' style='height:"+postHeight+"px'></div>")(scope);item=element.append(post);break;case"timelineDay":var postWidth=event.post_time*(element.width()+2)/totalDuration,_post=$compile("<div class='post' style='width:"+postWidth+"px'></div>")(scope);item=element.append(_post)}result.push(item)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return result}()}}}),angular.module("BBAdminDashboard.calendar.services").factory("TitleAssembler",[function(){var expression=new RegExp("\\{([a-zA-z_-]+)\\|?([a-zA-z_-]+)?:?([a-zA-z0-9{}_-]+)?\\}","g");return{getTitle:function(object,pattern){if(null==object||null==pattern)return null;var patternMatches=pattern.match(expression);if(null==patternMatches||0===patternMatches.length)return pattern;for(var label=pattern,index=0;index<patternMatches.length;index++){var match=patternMatches[index],parts=match.split(expression);if(parts.splice(0,1),parts.pop(),object.hasOwnProperty(parts[0])){var replaceWith=object[parts[0]];null!=parts[1]&&null!=$filter(parts[1])&&(replaceWith=null!=parts[2]?$filter(parts[1])(replaceWith,$scope.$eval(parts[2])):$filter(parts[1])(replaceWith)),label=label.replace(match,replaceWith)}else label=label.replace(match,"")}return label}}}]),angular.module("BBAdminDashboard.calendar.translations").config(["$translateProvider",function($translateProvider){return $translateProvider.translations("en",{ADMIN_DASHBOARD:{SIDE_NAV:{CALENDAR_PAGE:{CALENDAR:"Calendar",PEOPLE:"Staff",RESOURCES:"Resources"}},CALENDAR_PAGE:{NEXT:"Next",PREVIOUS:"Previous",CALENDAR:"Calendar",SHOW:"Show",ALL:"all",SOME:"some",SELECT_STAFF_RESOURCES:"Select staff or resource...",EMAIL:"email",TODAY:"Today",WEEK:"Week",MONTH:"Month",DAY:"Day",AGENDA:"Agenda",STAFF:"Staff",RESOURCES:"Resources",MOVE_MODAL_HEADING:"Move",MOVE_MODAL_BODY:"Are you sure you want to move?",ADD_BOOKING:"New Booking",DATE_PICKER:"Calendar date picker",INVALID_DATE:"Invalid date",SELECTED:"Selected",NO_EVENTS:"No events to display"}}})}]),angular.module("BBAdminDashboard.check-in.controllers").controller("CheckInPageCtrl",["$scope","$state","$log",function($scope,$state,$log){var pusher_channel=$scope.company.getPusherChannel("bookings"),refetch=_.throttle(function(data){return $log.info("== booking push received in checkin  == ",data),$scope.$broadcast("refetchCheckin",data)},1e3,{leading:!1});if(pusher_channel)return pusher_channel.bind("create",refetch),pusher_channel.bind("update",refetch),pusher_channel.bind("destroy",refetch)}]),angular.module("BBAdminDashboard.check-in.directives").directive("bbAddWalkin",function(){return{restrict:"AE",replace:!0,scope:!0,link:function(scope,element,attrs){},controller:function($scope,AdminBookingPopup,$timeout){return $scope.walkIn=function(){return AdminBookingPopup.open({item_defaults:{pick_first_time:!0,merge_people:!0,merge_resources:!0,date:moment().format("YYYY-MM-DD")},on_conflict:"cancel()",company_id:$scope.bb.company.id})}}}}),angular.module("BBAdminDashboard.check-in.directives").directive("bbCheckinTable",function(){return{restrict:"AE",replace:!1,scope:!0,templateUrl:"check-in/checkin-table.html",controller:"CheckinsController",link:function(scope,element,attrs){}}}),angular.module("BBAdminDashboard.check-in.directives").controller("CheckinsController",function($scope,$rootScope,BusyService,$q,$filter,AdminTimeService,ModalForm,AdminSlotService,$timeout,AlertService,BBModel,AdminCompanyService,$attrs,AdminMoveBookingPopup){var company=null;$scope.$on("refetchCheckin",function(event,res){return $scope.getAppointments(null,null,null,null,null,!0)}),$scope.getAppointments=function(currentPage,filterBy,filterByFields,orderBy,orderByReverse,skipCache){if(null==skipCache&&(skipCache=!0),filterByFields&&null!=filterByFields.name&&(filterByFields.name=filterByFields.name.replace(/\s/g,"")),filterByFields&&null!=filterByFields.mobile){var mobile=filterByFields.mobile;0===mobile.indexOf("0")&&(filterByFields.mobile=mobile.substring(1))}var defer=$q.defer(),params={company:$scope.company,date:moment().format("YYYY-MM-DD"),url:$scope.bb.api_url};return skipCache&&(params.skip_cache=!0),filterBy&&(params.filter_by=filterBy),filterByFields&&(params.filter_by_fields=filterByFields),orderBy&&(params.order_by=orderBy),orderByReverse&&(params.order_by_reverse=orderByReverse),BBModel.Admin.Booking.$query(params).then(function(res){$scope.booking_collection=res,$scope.bookings=[],$scope.bmap={};var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=Array.from(res.items)[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var item=_step.value;3!==item.status&&($scope.bookings.push(item.id),$scope.bmap[item.id]=item)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return $scope.booking_collection.addCallback($scope,function(booking,status){return $scope.bookings=[],$scope.bmap={},function(){var result=[],_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=Array.from($scope.booking_collection.items)[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){item=_step2.value;var item1=void 0;3!==item.status&&($scope.bookings.push(item.id),item1=$scope.bmap[item.id]=item),result.push(item1)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}return result}()}),defer.resolve($scope.bookings)},function(err){return defer.reject(err)}),defer.promise},$scope.setStatus=function(booking,status){var clone=_.clone(booking);return clone.current_multi_status=status,booking.$update(clone).then(function(res){return $scope.booking_collection.checkItem(res)},function(err){return AlertService.danger({msg:"Something went wrong"})})};var getCompanyPromise=function(){var defer=$q.defer();return company?defer.resolve(company):AdminCompanyService.query($attrs).then(function(_company){company=_company,defer.resolve(company)}),defer.promise};return $scope.edit=function(booking){return booking.$getAnswers().then(function(answers){var _iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=Array.from(answers.answers)[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var answer=_step3.value;booking["question"+answer.question_id]=answer.value}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3.return&&_iterator3.return()}finally{if(_didIteratorError3)throw _iteratorError3}}return ModalForm.edit({model:booking,title:"Booking Details",templateUrl:"edit_booking_modal_form.html",success:function(b){if("move"===b){var item_defaults={person:booking.person_id,resource:booking.resource_id};getCompanyPromise().then(function(company){return AdminMoveBookingPopup.open({item_defaults:item_defaults,company_id:company.id,
booking_id:booking.id})})}}})})},$scope.getAppointments(null,null,null,null,null,!0)}),angular.module("BBAdminDashboard.check-in.services").provider("AdminCheckInOptions",[function(){var options={use_default_states:!0,show_in_navigation:!0,parent_state:"root"};this.setOption=function(option,value){options.hasOwnProperty(option)&&(options[option]=value)},this.getOption=function(option){if(options.hasOwnProperty(option))return options[option]},this.$get=function(){return options}}]),angular.module("BBAdminDashboard.check-in.translations").config(["$translateProvider",function($translateProvider){return $translateProvider.translations("en",{ADMIN_DASHBOARD:{SIDE_NAV:{CHECK_IN_PAGE:{CHECK_IN:"Check in"}},CHECK_IN_PAGE:{CHECK_IN:"Check in",EDIT:"Edit",NO_SHOW:"No Show",WALK_IN:"Walk in",CUSTOMER:"Customer",STAFF_MEMBER:"Staff Member",DUE:"Due",ARRIVED:"Arrived",BEING_SEEN:"Being Seen",COMPLETED:"Completed",NO_SHOW_BUTTON:"Mark No Show",CHECK_IN_BUTTON:"Check in",SERVE:"Serve",WAITING_FOR:"Waiting for {{period}}",BEING_SEEN_FOR:"Being seen for {{period}}",WAS_DUE:"Was due {{period}}",COMPLETED_BUTTON:"Completed"}}})}]),angular.module("BBAdminDashboard.clients.controllers").controller("ClientsAllPageCtrl",["$scope","$state",function($scope,$state){return $scope.set_current_client(null)}]),angular.module("BBAdminDashboard.clients.controllers").controller("ClientsEditPageCtrl",function($scope,client,$state,company,BBModel){$scope.client=client,$scope.historicalStartDate=moment().add(-1,"years"),$scope.historicalEndDate=moment();var checkNameAndEmail=function(newVal,oldVal){void 0===newVal&&""===oldVal&&($scope.$broadcast("schemaForm.error.first_name","nameOrEmail",!0),$scope.$broadcast("schemaForm.error.last_name","nameOrEmail",!0),$scope.$broadcast("schemaForm.error.email","nameOrEmail",!0));var attributes=[$scope.client.first_name,$scope.client.last_name,$scope.client.email];_.every(attributes,_.isEmpty)?($scope.$broadcast("schemaForm.error.first_name","nameOrEmail","Either a name or email address is required"),$scope.$broadcast("schemaForm.error.last_name","nameOrEmail","Either a name or email address is required"),$scope.$broadcast("schemaForm.error.email","nameOrEmail","Either a name or email address is required")):($scope.$broadcast("schemaForm.error.first_name","nameOrEmail",!0),$scope.$broadcast("schemaForm.error.last_name","nameOrEmail",!0),$scope.$broadcast("schemaForm.error.email","nameOrEmail",!0),$scope.$broadcast("schemaForm.error.email","default",!0))};return $scope.$watch("client.first_name",checkNameAndEmail),$scope.$watch("client.last_name",checkNameAndEmail),$scope.$watch("client.email",checkNameAndEmail),$scope.memberSaveCallback=function(){var params={company:company,company_id:company.id,id:$state.params.id,flush:!0};return BBModel.Admin.Client.$query(params).then(function(client){return $scope.client=client})}}),angular.module("BBAdminDashboard.clients.controllers").controller("ClientsNewPageCtrl",["$scope","$state",function($scope,$state){$scope.onSuccess=function(){$state.go("clients.all")}}]),angular.module("BBAdminDashboard.clients.controllers").controller("ClientsPageCtrl",["$scope","$state",function($scope,$state){return $scope.clientsOptions={search:null},$scope.set_current_client=function(client){return $scope.current_client=client}}]),angular.module("BBAdminDashboard.clients.directives").directive("bbClientsTable",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"TabletClients",link:function(scope,element,attrs){}}}),angular.module("BBAdminDashboard.clients.directives").controller("TabletClients",function($scope,$rootScope,$q,BBModel,AlertService){return $scope.clientDef=$q.defer(),$scope.clientPromise=$scope.clientDef.promise,$scope.per_page=15,$scope.total_entries=0,$scope.clients=[],$scope.getClients=function(currentPage,filterBy,filterByFields,orderBy,orderByReverse){var fields=angular.copy(filterByFields);if(null!=fields.mobile){var mobile=fields.mobile;0===mobile.indexOf("0")&&(fields.mobile=mobile.substring(1))}var clientDef=$q.defer(),params={company:$scope.bb.company,per_page:$scope.per_page,page:currentPage+1,filter_by:filterBy,filter_by_fields:fields,order_by:orderBy,order_by_reverse:orderByReverse};return BBModel.Admin.Client.$query(params).then(function(clients){return $scope.clients=clients.items,$scope.total_entries=clients.total_entries,clientDef.resolve(clients.items)},function(err){return console.log(err),clientDef.reject(err)})}}),angular.module("BBAdminDashboard.clients.services").provider("AdminClientsOptions",[function(){var options={use_default_states:!0,show_in_navigation:!0,parent_state:"root"};this.setOption=function(option,value){options.hasOwnProperty(option)&&(options[option]=value)},this.getOption=function(option){if(options.hasOwnProperty(option))return options[option]},this.$get=function(){return options}}]),angular.module("BBAdminDashboard.clients.translations").config(["$translateProvider",function($translateProvider){return $translateProvider.translations("en",{ADMIN_DASHBOARD:{SIDE_NAV:{CLIENTS_PAGE:{CLIENTS:"Customers"}},CLIENTS_PAGE:{CLIENTS:"Customers",CLIENT:"Customer",NAME:"Name",EMAIL:"Email",MOBILE:"Mobile",PHONE:"Phone",ACTIONS:"Actions",EDIT:"Edit",ABOUT:"About",ADDRESS:"Address",UPCOMING_BOOKINGS:"Upcoming Bookings",PAST_BOOKINGS:"Past Bookings",CUSTOMER_DETAILS:"Customer Details",NEW:"New Customer"}}})}]),angular.module("BBAdminDashboard.config-iframe.controllers").controller("ConfigIframeBookingSettingsPageCtrl",["$scope","$state","$rootScope",function($scope,$state,$rootScope){return $scope.pageHeader="ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.BOOKING_SETTINGS.TITLE",$scope.tabs=[{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.BOOKING_SETTINGS.TAB_QUESTIONS",icon:"fa fa-question-circle",path:'config.booking-settings.page({path: "detail_type"})'},{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.BOOKING_SETTINGS.TAB_QUESTION_GROUPS",icon:"fa fa-question-circle",path:'config.booking-settings.page({path: "detail_group"})'},{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.BOOKING_SETTINGS.TAB_BOOKING_TEXT",icon:"fa fa-file-text",path:'config.booking-settings.page({path: "conf/text/text_edit"})'},{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.BOOKING_SETTINGS.TAB_ADDRESSES",icon:"fa fa-building-o",path:'config.booking-settings.page({path: "address"})'},{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.BOOKING_SETTINGS.TAB_IMAGES",icon:"fa fa-picture-o",path:'config.booking-settings.page({path: "media/image/all"})'}],$scope.contentsLoading=!1,$scope.$on("iframeLoaded",function(){return $scope.contentsLoading=!1,$scope.$apply()}),$scope.$on("iframeLoading",function(){return $scope.contentsLoading=!0})}]),angular.module("BBAdminDashboard.config-iframe.controllers").controller("ConfigIframeBusinessPageCtrl",["$scope","$state","$rootScope",function($scope,$state,$rootScope){return $scope.pageHeader="ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.BUSINESS.TITLE",$scope.tabs=[{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.BUSINESS.TAB_STAFF",icon:"fa fa-male",path:'config.business.page({path: "person"})'},{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.BUSINESS.TAB_RESOURCES",icon:"fa fa-diamond",path:'config.business.page({path: "resource"})'},{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.BUSINESS.TAB_SERVICES",icon:"fa fa-wrench",path:'config.business.page({path: "service"})'},{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.BUSINESS.TAB_WHO_WHAT_WHERE",icon:"fa fa-question-circle",path:'config.business.page({path: "grid"})'},{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.BUSINESS.TAB_QUEUES",icon:"fa fa-users",path:'config.business.page({path: "client_queue"})'}],$scope.contentsLoading=!1,$scope.$on("iframeLoaded",function(){return $scope.contentsLoading=!1,$scope.$apply()}),$scope.$on("iframeLoading",function(){return $scope.contentsLoading=!0})}]),angular.module("BBAdminDashboard.config-iframe.controllers").controller("ConfigIframeEventSettingsPageCtrl",["$scope","$state","$rootScope",function($scope,$state,$rootScope){return $scope.pageHeader="ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.EVENT_SETTINGS.TITLE",$scope.tabs=[{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.EVENT_SETTINGS.TAB_COURSES",icon:"fa fa-clipboard",path:'config.event-settings.page({path: "sessions/courses"})'},{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.EVENT_SETTINGS.TAB_SINGLE_EVENTS",icon:"fa fa-ticket",path:'config.event-settings.page({path: "sessions/events"})'},{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.EVENT_SETTINGS.TAB_REGULAR_EVENTS",icon:"fa fa-calendar",path:'config.event-settings.page({path: "sessions/recurring"})'},{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.EVENT_SETTINGS.TAB_GROUPS",icon:"fa fa-object-group",path:'config.event-settings.page({path: "sessions/types"})'},{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.EVENT_SETTINGS.TAB_TEMPLATES",icon:"fa fa-folder-open",path:'config.event-settings.page({path: "sessions/template"})'}],$scope.contentsLoading=!1,$scope.$on("iframeLoaded",function(){return $scope.contentsLoading=!1,$scope.$apply()}),$scope.$on("iframeLoading",function(){return $scope.contentsLoading=!0})}]),angular.module("BBAdminDashboard.config-iframe.controllers").controller("ConfigIframePageCtrl",["$scope","$state","$rootScope",function($scope,$state,$rootScope){return $scope.parent_state=$state.is("config"),$scope.path="edit",$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){if($scope.parent_state=!1,"config"===toState.name)return $scope.parent_state=!0})}]),angular.module("BBAdminDashboard.config-iframe.controllers").controller("ConfigIframePromotionsPageCtrl",["$scope","$state","$rootScope",function($scope,$state,$rootScope){return $scope.pageHeader="ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.PROMOTIONS.TITLE",$scope.tabs=[{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.PROMOTIONS.TAB_DEALS",icon:"fa fa-exclamation-triangle",path:'config.promotions.page({path: "price/deal/summary"})'},{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.PROMOTIONS.TAB_COUPONS",icon:"fa fa-money",path:'config.promotions.page({path: "price/coupon"})'},{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.PROMOTIONS.TAB_BULK_PURCHASES",icon:"fa fa-th",path:'config.promotions.page({path: "price/block"})'},{name:"ADMIN_DASHBOARD.CONFIG_IFRAME_PAGE.PROMOTIONS.TAB_PACKAGES",icon:"fa fa-gift",path:'config.promotions.page({path: "package"})'}],$scope.contentsLoading=!1,$scope.$on("iframeLoaded",function(){return $scope.contentsLoading=!1,$scope.$apply()}),$scope.$on("iframeLoading",function(){return $scope.contentsLoading=!0})}]),angular.module("BBAdminDashboard.config-iframe.controllers").controller("ConfigSubIframePageCtrl",["$scope","$state","$stateParams",function($scope,$state,$stateParams){return $scope.path=$stateParams.path,$scope.pageHeader=null,$scope.$emit("iframeLoading",{}),$scope.onIframeLoad=function(){return $scope.$emit("iframeLoaded",{})}}]),angular.module("BBAdminDashboard.config-iframe.services").provider("AdminConfigIframeOptions",[function(){var options={use_default_states:!0,show_in_navigation:!0,parent_state:"root"};this.setOption=function(option,value){options.hasOwnProperty(option)&&(options[option]=value)},this.getOption=function(option){if(options.hasOwnProperty(option))return options[option]},this.$get=function(){return options}}]),angular.module("BBAdminDashboard.config-iframe.translations").config(["$translateProvider",function($translateProvider){return $translateProvider.translations("en",{ADMIN_DASHBOARD:{SIDE_NAV:{CONFIG_IFRAME_PAGE:{CONFIG:"Config",YOUR_BUSINESS:"Your business",EVENT_SETTINGS:"Event settings",PROMOTIONS:"Promotions",BOOKING_SETTINGS:"Booking settings"}},CONFIG_IFRAME_PAGE:{BUSINESS:{TITLE:"Configure: Business",TAB_STAFF:"Staff",TAB_RESOURCES:"Resource",TAB_SERVICES:"Services",TAB_WHO_WHAT_WHERE:"Who / What / Where",TAB_QUEUES:"Queues"},EVENT_SETTINGS:{TITLE:"Event settings",TAB_COURSES:"Courses",TAB_SINGLE_EVENTS:"Single events",TAB_REGULAR_EVENTS:"Regular events",TAB_GROUPS:"Groups",TAB_TEMPLATES:"Templates"},PROMOTIONS:{TITLE:"Promotions",TAB_DEALS:"Deals",TAB_COUPONS:"Coupons",TAB_BULK_PURCHASES:"Bulk purchases",TAB_PACKAGES:"Packages"},BOOKING_SETTINGS:{TITLE:"Booking settings",TAB_QUESTIONS:"Questions",TAB_QUESTION_GROUPS:"Question Groups",TAB_BOOKING_TEXT:"Booking text",TAB_ADDRESSES:"Addresses",TAB_IMAGES:"Images"}}}})}]),function(){function UserPreferencesCtrl(){this.preventClose=function(event){return event.stopPropagation()}}angular.module("BBAdminDashboard").component("bbUserPreferences",{templateUrl:"core/_bb_user_preferences.html",controller:UserPreferencesCtrl,controllerAs:"$bbUserPreferencesCtrl"})}(),function(){function corePageController($scope,$state,company,$uibModalStack,$rootScope,CompanyStoreService,bbTimeZone,$sessionStorage){"ngInject";$scope.company=company,$scope.bb.company=company,$scope.user=$rootScope.user,$scope.multiLocationUser=$sessionStorage.getItem("multiLocationUser"),CompanyStoreService.country_code=company.country_code,CompanyStoreService.currency_code=company.currency_code,CompanyStoreService.time_zone=company.timezone,bbTimeZone.determine(),$scope.isState=function(states){return $state.includes(states)},$rootScope.$on("$stateChangeStart",function(){return $uibModalStack.dismissAll()})}angular.module("BBAdminDashboard").controller("CorePageController",corePageController)}(),angular.module("BBAdminDashboard").directive("adminIframe",function($window,$timeout){return{restrict:"A",scope:{path:"=",apiUrl:"=",fullHeight:"=?",extraParams:"=?",onLoad:"=?"},templateUrl:"core/admin-iframe.html",controller:["$scope","$sce",function($scope,$sce){return $scope.frameSrc=$sce.trustAsResourceUrl($scope.apiUrl+"/"+unescape($scope.path)+"?whitelabel=adminlte&uiversion=aphid&"+($scope.extraParams?$scope.extraParams:void 0))}],link:function(scope,element,attrs){var calculateFullHeight=function(containerHeight){var heightToConsider=0,contentSection=angular.element(document.querySelectorAll("section.content"));return contentSection.length&&(contentSection=contentSection[0],heightToConsider+=parseInt($window.getComputedStyle(contentSection,null).getPropertyValue("padding-top")),heightToConsider+=parseInt($window.getComputedStyle(contentSection,null).getPropertyValue("padding-bottom"))),containerHeight-heightToConsider};element.find("iframe")[0].onload=function(){if(scope.$emit("iframeLoaded",{}),"function"==typeof scope.onLoad)return this.style.display="block",scope.onLoad()},scope.fullHeight?(element.find("iframe").height(calculateFullHeight(angular.element(document.querySelector("#content-wrapper")).height())+"px"),scope.$on("content.changed",function(event,data){return element.find("iframe").height(calculateFullHeight(data.height)+"px")})):$window.addEventListener("message",function(event){if(event.data.height)return element.find("iframe").height(event.data.height+"px")})}}}),angular.module("BBAdminDashboard").directive("adminSideNav",function(){return{restrict:"A",scope:!1,templateUrl:"core/admin-side-nav.html",controller:["$scope","SideNavigationPartials",function($scope,SideNavigationPartials){return $scope.navigation=SideNavigationPartials.getOrderedPartialTemplates()}],link:function(scope,element,attrs){}}}),angular.module("BBAdminDashboard").directive("bbAdminDashboard",function(PageLayout){return{restrict:"AE",scope:{bb:"=",companyId:"@",ssoToken:"@"},template:"<div ui-view></div>",controller:["$scope","$rootScope","$element","$compile","$localStorage","$state","PageLayout","BBModel","AdminSsoLogin","AdminLoginOptions",function($scope,$rootScope,$element,$compile,$localStorage,$state,PageLayout,BBModel,AdminSsoLogin,AdminLoginOptions){$rootScope.bb=$scope.bb,$scope.currentYear=moment().local().format("YYYY");var api_url=$localStorage.getItem("api_url");!$scope.bb.api_url&&api_url&&($scope.bb.api_url=api_url),AdminSsoLogin.apiUrl=$scope.bb.api_url,AdminSsoLogin.ssoToken=null!=$scope.ssoToken?$scope.ssoToken:AdminLoginOptions.sso_token,AdminSsoLogin.companyId=null!=$scope.companyId?$scope.companyId:AdminLoginOptions.company_id,$scope.$on("$stateChangeError",function(evt,to,toParams,from,fromParams,error){switch(error.reason){case"NOT_LOGGABLE_ERROR":case"COMPANY_IS_PARENT":return evt.preventDefault(),$state.go("login")}}),$scope.openSideMenu=function(){return PageLayout.sideMenuOn=!0},$scope.closeSideMenu=function(){return PageLayout.sideMenuOn=!1},$scope.toggleSideMenu=function(){return PageLayout.sideMenuOn=!PageLayout.sideMenuOn}}],link:function(scope,element,attrs){return scope.page=PageLayout,scope.$watch("page",function(newPage,oldPage){return newPage.sideMenuOn?(element.addClass("sidebar-open"),element.removeClass("sidebar-collapse")):(element.addClass("sidebar-collapse"),element.removeClass("sidebar-open")),newPage.boxed?element.addClass("layout-boxed"):element.removeClass("layout-boxed")},!0)}}}),angular.module("BBAdminDashboard").directive("bbChildCompanySwitch",function(){return{restrict:"A",replace:!0,scope:!0,controller:function($scope,$state,AdminLoginService){return $scope.logoutChildCompany=function(){$scope.bb.company.$getParent().then(function(parent_company){AdminLoginService.setCompany(parent_company.id).then(function(response){$state.go("login")},function(err){return $scope.formErrors.push({message:"ADMIN_DASHBOARD.LOGIN_PAGE.ERROR_ISSUE_WITH_COMPANY"})})},function(err){return $scope.formErrors.push({message:"ADMIN_DASHBOARD.LOGIN_PAGE.ERROR_ISSUE_WITH_COMPANY"})})}}}}),angular.module("BBAdminDashboard").directive("bbClassicSwitch",function(){return{restrict:"A",scope:!1,link:function(scope,element,attrs){if(scope.bb.api_url)return attrs.$set("href",scope.bb.api_url+"?dashboard_redirect=true")}}}),angular.module("BBAdminDashboard").directive("bbIfLogin",function($uibModal,$log,$q,$rootScope,AdminCompanyService,$compile,$templateCache,ModalForm,BBModel){return{compile:function(){return{pre:function(scope,element,attributes){return scope.notLoaded=function(sc){return null},scope.setLoaded=function(sc){return null},scope.setPageLoaded=function(){return null},$rootScope.start_deferred=$q.defer(),$rootScope.connection_started=$rootScope.start_deferred.promise,this.whenready=$q.defer(),scope.loggedin=this.whenready.promise,AdminCompanyService.query(attributes).then(function(company){return scope.company=company,scope.bb||(scope.bb={}),scope.bb.company=company,this.whenready.resolve(),$rootScope.start_deferred.resolve()})},post:function(scope,element,attributes){}}}}}),angular.module("BBAdminDashboard").directive("bbSchemaForm",function($log,FormTransform){"ngInject";return{template:'<div uib-alert ng-class="\'alert-\' + alert.type" ng-if="alert">{{alert.msg}}</div>\n  <form name="formCtrl" sf-schema="schema" sf-form="form" sf-model="form_model"\n  ng-submit="submit(formCtrl)" ng-hide="loading" ng-if="schema && form && form_model" sf-options="options"></form>',scope:{base:"=",formRel:"@",saveRel:"@",onSuccessSave:"=",onFailSave:"=",options:"=",formModel:"=?"},controller:function($scope){return $scope.loading=!0,$scope.base.$has($scope.formRel)?$scope.base.$get($scope.formRel).then(function(schema){return $scope.form=schema.form,FormTransform.new[$scope.formRel]&&($scope.form=FormTransform.new[$scope.formRel]($scope.form)),$scope.schema=schema.schema,$scope.formModel?$scope.form_model=$scope.formModel:$scope.form_model={},$scope.loading=!1}):$log.warn("model does not have '"+formRel+"' rel"),$scope.submit=function(form){if($scope.alert=!1,$scope.$broadcast("schemaFormValidate"),form.$valid)return $scope.loading=!0,$scope.base.$post($scope.saveRel,{},$scope.form_model).then(function(response){if($scope.loading=!1,$scope.onSuccessSave)return $scope.onSuccessSave(response)},function(err){if($scope.loading=!1,err.data&&err.data.error?($log.error(err.data.error),$scope.alert={type:"danger",msg:err.data.error}):($log.error("Something went wrong"),$scope.alert={type:"danger",msg:"Something went wrong"}),$scope.onFailSave)return $scope.onFailSave()})}}}}),angular.module("BBAdminDashboard").directive("bbSchemaFormEdit",function($log,FormTransform){"ngInject";return{template:'<div uib-alert ng-class="\'alert-\' + alert.type" ng-if="alert">{{alert.msg}}</div>\n  <form name="formCtrl" sf-schema="schema" sf-form="form" sf-model="form_model"\n  ng-submit="submit(formCtrl)" ng-hide="loading" ng-if="schema && form && form_model" sf-options="options"></form>',link:function(scope,element,attrs){console.log("schema form link"),scope.$watch("model",function(n){console.log("model change ",n)})},scope:{model:"=",onSuccessSave:"=",onFailSave:"=",options:"="},controller:function($scope){return console.log("schema form"),$scope.$watch("model",function(n){console.log("model change ",n)}),$scope.loading=!0,$scope.model.$has("edit")?$scope.model.$get("edit").then(function(schema){$scope.form=schema.form;var model_type=$scope.model.constructor.name;return FormTransform.edit[model_type]&&($scope.form=FormTransform.edit[model_type]($scope.form)),$scope.schema=schema.schema,$scope.form_model=$scope.model,$scope.loading=!1}):$log.warn("model does not have 'edit' rel"),$scope.submit=function(form){if($scope.$broadcast("schemaFormValidate"),form.$valid)return $scope.loading=!0,$scope.model.$update?$scope.model.$update($scope.form_model).then(function(){if($scope.loading=!1,$scope.onSuccessSave)return $scope.onSuccessSave($scope.model)},function(err){if($scope.loading=!1,$log.error("Failed to create"),$scope.onFailSave)return $scope.onFailSave()}):$scope.model.$put("self",{},$scope.form_model).then(function(model){if($scope.loading=!1,$scope.onSuccessSave)return $scope.onSuccessSave(model)},function(err){if($scope.loading=!1,err.data&&err.data.error?($log.error(err.data.error),$scope.alert={type:"danger",msg:err.data.error}):($log.error("Something went wrong"),$scope.alert={type:"danger"}),$scope.onFailSave)return $scope.onFailSave()})}}}}),angular.module("BBAdminDashboard").directive("bodyResize",function($window,$timeout,AdminCoreOptions,PageLayout){return{restrict:"A",link:function(scope,element){$timeout(function(){_sideMenuSetup(!0)},0),angular.element($window).bind("resize",function(){_sideMenuSetup()});var _sideMenuSetup=function(firstLoad){null==firstLoad&&(firstLoad=!1),$window.innerWidth>768&&(!firstLoad||AdminCoreOptions.sidenav_start_open)&&!AdminCoreOptions.deactivate_sidenav?PageLayout.sideMenuOn=!0:PageLayout.sideMenuOn=!1}}}}),angular.module("BBAdminDashboard").directive("contentHeight",function($window,$timeout){return{restrict:"A",link:function(scope,element,attributes){var includeFooter=!0,includeHeader=!0;null!=attributes.includeHeader&&(includeHeader=attributes.includeHeader),null!=attributes.includeFooter&&(includeFooter=attributes.includeFooter),$timeout(function(){_contentHeightSetup()},10),angular.element($window).bind("resize",function(){_contentHeightSetup()});var _contentHeightSetup=function(){var height=$window.innerHeight;!0===includeHeader&&(height-=angular.element(document).find("header")[0]?angular.element(document).find("header")[0].offsetHeight:0),!0===includeFooter&&(height-=angular.element(document).find("footer")[0]?angular.element(document).find("footer")[0].offsetHeight:0),element.css({height:height+"px"}),scope.$emit("content.changed",{height:height}),scope.$broadcast("content.changed",{height:height})}}}}),angular.module("BBAdminDashboard").filter("minutesToString",function(){return function(minutes,format){return null==format&&(format="HH:mm"),moment(moment.duration(minutes,"minutes")._data).format(format)}}),angular.module("BBAdminDashboard").provider("AdminCoreOptions",function(){"ngInject";var options={default_state:"calendar",deactivate_sidenav:!1,deactivate_boxed_layout:!1,sidenav_start_open:!0,boxed_layout_start:!1,side_navigation:[{group_name:"SIDE_NAV_BOOKINGS",items:["calendar","clients","check-in","dashboard-iframe","members-iframe"]},{group_name:"SIDE_NAV_CONFIG",items:["config-iframe","publish-iframe","settings-iframe"]}],onLogoutRedirectionURL:null};this.setOption=function(option,value){options.hasOwnProperty(option)&&(options[option]=value)},this.getOption=function(option){if(options.hasOwnProperty(option))return options[option]},this.$get=function(){return options}}),angular.module("BBAdminDashboard").factory("AdminSsoLogin",function(halClient){return{ssoToken:null,companyId:null,apiUrl:null,ssoLoginPromise:function(ssoToken,companyId,apiUrl,childCompanyId){var _this=this;return new Promise(function(resolve,reject){ssoToken||(ssoToken=_this.ssoToken),companyId||(companyId=_this.companyId),apiUrl||(apiUrl=_this.apiUrl),ssoToken&&companyId&&apiUrl||reject({status:500});var SSOParams={token:ssoToken};childCompanyId&&(SSOParams.company_id=childCompanyId),halClient.$post(apiUrl+"/api/v1/login/admin_sso/"+companyId,{},SSOParams).then(function(login){var loginParams={auth_token:login.auth_token};return login.$get("administrator",loginParams)}).then(resolve).catch(reject)})}}}),angular.module("BBAdminDashboard").factory("AdminSsoLoginUrl",["$rootScope","company_id","$exceptionHandler",function($rootScope,company_id,$exceptionHandler){return null==$rootScope.bb.companyId&&($rootScope.bb.companyId|=company_id),$rootScope.bb.companyId||$exceptionHandler(new Error('Angular value "company_id" is undefined! '),"",!0),$rootScope.bb.api_url+"/api/v1/login/admin_sso/"+$rootScope.bb.companyId}]),angular.module("BBAdminDashboard").factory("BusyService",function($q,$log,$rootScope,AlertService,ErrorService){return{notLoaded:function(cscope){for(cscope.$emit("show:loader",cscope),cscope.isLoaded=!1;cscope;)cscope.hasOwnProperty("scopeLoaded")&&(cscope.scopeLoaded=!1),cscope=cscope.$parent},setLoaded:function(cscope){cscope.$emit("hide:loader",cscope),cscope.isLoaded=!0;for(var loadingFinished=!0;cscope;)cscope.hasOwnProperty("scopeLoaded")&&($scope.areScopesLoaded(cscope)?cscope.scopeLoaded=!0:loadingFinished=!1),cscope=cscope.$parent;if(loadingFinished)return $rootScope.$broadcast("loading:finished")},setPageLoaded:function(scope){return null},setLoadedAndShowError:function(scope,err,error_string){return $log.warn(err,error_string),this.setLoaded(scope),409===err.status?"Rule checking failed"===err.data.error?AlertService.danger(ErrorService.createCustomError(err.data.message)):AlertService.danger(ErrorService.getError("ITEM_NO_LONGER_AVAILABLE")):err.data&&"Number of Bookings exceeds the maximum"===err.data.error?AlertService.danger(ErrorService.getError("MAXIMUM_TICKETS")):AlertService.danger(ErrorService.getError("GENERIC"))},areScopesLoaded:function(cscope){if(cscope.hasOwnProperty("isLoaded")&&!cscope.isLoaded)return!1;for(var child=cscope.$$childHead;child;){if(!$scope.areScopesLoaded(child))return!1;child=child.$$nextSibling}return!0}}}),angular.module("BBAdminDashboard").factory("PageLayout",["AdminCoreOptions",function(AdminCoreOptions){return{hideSideMenuControl:this.hideSideMenuControl?this.hideSideMenuControl:AdminCoreOptions.deactivate_sidenav,hideBoxedLayoutControl:this.hideBoxedLayoutControl?this.hideBoxedLayoutControl:AdminCoreOptions.deactivate_boxed_layout,sideMenuOn:this.sideMenuOn?this.sideMenuOn:AdminCoreOptions.sidenav_start_open&&!AdminCoreOptions.deactivate_sidenav,boxed:this.boxed?this.boxed:AdminCoreOptions.boxed_layout_start}}]),angular.module("BBAdminDashboard").provider("RuntimeRoutes",["$urlRouterProvider",function($urlRouterProvider){var routeProvider=$urlRouterProvider;this.setProvider=function(provider){return routeProvider=provider},this.$get=function(){return routeProvider}}]),angular.module("BBAdminDashboard").provider("RuntimeStates",["$stateProvider",function($stateProvider){var stateProvider=$stateProvider;this.setProvider=function(provider){return stateProvider=provider},this.$get=function(){return stateProvider}}]),angular.module("BBAdminDashboard").factory("SideNavigationPartials",["AdminCoreOptions",function(AdminCoreOptions){var templatesArray=[];return{addPartialTemplate:function(identifier,partial){_.find(templatesArray,function(item){return item.module===identifier})||templatesArray.push({module:identifier,navPartial:partial})},removePartialTemplate:function(identifier){var partial=_.findWhere(templatesArray,{module:identifier}),index=_.indexOf(templatesArray,partial);templatesArray.splice(index,1)},getPartialTemplates:function(){return templatesArray},getOrderedPartialTemplates:function(){var flat=arguments.length>0&&void 0!==arguments[0]&&arguments[0],orderedList=[],flatOrderedList=[];return angular.forEach(AdminCoreOptions.side_navigation,function(group,index){if(angular.isArray(group.items)&&group.items.length){var newGroup={group_name:group.group_name,items:[]};return angular.forEach(group.items,function(item,index){var existing=_.find(templatesArray,function(template){return template.module===item});if(existing)return flatOrderedList.push(existing),newGroup.items.push(existing)}),orderedList.push(newGroup)}}),flat?flatOrderedList:orderedList}}}]),angular.module("BBAdminDashboard").factory("TemplateService",function($templateCache,$exceptionHandler){return{get:function(template){return null!=$templateCache.get(template)?$templateCache.get(template):null!=$templateCache.get("/default"+template)?$templateCache.get("/default"+template):$exceptionHandler(new Error('Template "'+template+'" not found'),"",!0)}}}),function(){function translationsConfig($translateProvider){"ngInject";var translations={SIDE_NAV_BOOKINGS:"BOOKINGS",SIDE_NAV_CONFIG:"CONFIGURATION",ADMIN_DASHBOARD:{CORE:{GREETING:"Hi",LOGOUT:"Logout",VERSION:"Version",COPYRIGHT:"Copyright",SWITCH_TO_CLASSIC:"Switch to Classic",LOGO:"Logo"},MODAL:{NEW_BOOKING_HEADER:"New Booking"}}};$translateProvider.translations("en",translations)}angular.module("BBAdminDashboard").config(translationsConfig)}(),angular.module("BBAdminDashboard.dashboard-iframe.controllers").controller("DashboardIframePageCtrl",["$scope","$state","$window","AdminBookingPopup",function($scope,$state,$window,AdminBookingPopup){return $scope.parent_state=$state.is("view"),$scope.bb.side_menu="dashboard_menu",$scope.path="view/dashboard/index",$window.addEventListener("message",function(event){if(event&&event.data&&event.data.type&&"booking"===event.data.type)return AdminBookingPopup.open({size:"lg",company_id:$scope.bb.company.id,on_conflict:"cancel()",item_defaults:{date:event.data.date,time:5*event.data.iarray,person:event.data.person,resource:event.data.resource}})})}]),angular.module("BBAdminDashboard.dashboard-iframe.controllers").controller("DashboardSubIframePageCtrl",["$scope","$state","$stateParams",function($scope,$state,$stateParams){if($scope.path=$stateParams.path,"view/dashboard/index"===$scope.path)return $scope.fullHeight=!0}]),angular.module("BBAdminDashboard.dashboard-iframe.services").provider("AdminDashboardIframeOptions",[function(){var options={use_default_states:!0,show_in_navigation:!0,parent_state:"root"};this.setOption=function(option,value){options.hasOwnProperty(option)&&(options[option]=value)},this.getOption=function(option){if(options.hasOwnProperty(option))return options[option]},this.$get=function(){return options}}]),angular.module("BBAdminDashboard.dashboard-iframe.translations").config(["$translateProvider",function($translateProvider){return $translateProvider.translations("en",{ADMIN_DASHBOARD:{SIDE_NAV:{DASHBOARD_IFRAME_PAGE:{DASHBOARD:"Dashboard",UPCOMING_RECENT:"Upcoming & Recent",SEARCH:"Search",BULK_BOOKINGS:"Bulk bookings",INSIGHTS:"Insights"}}}})}]),angular.module("BBAdminDashboard.login.controllers").controller("LoginPageCtrl",["$scope","$state","AdminLoginService","AdminCoreOptions","user",function($scope,$state,AdminLoginService,AdminCoreOptions,user){$scope.user=user,$scope.loginSuccess=function(company){return $scope.company=company,$scope.bb.company=company,$state.go(AdminCoreOptions.default_state)}}]),function(angular){function adminDashboardLoginCtrl($scope,$rootScope,BBModel,$sessionStorage,$localStorage,$state,AdminLoginOptions,QueryStringService,AdminSsoLogin,halClient){"ngInject";var _this=this,handleSSO=function(childCompanyId){_this.ssoToken&&(AdminLoginOptions.sso_token=_this.ssoToken,
AdminSsoLogin.ssoLoginPromise(_this.ssoToken,null,null,childCompanyId).then(function(admin){BBModel.Admin.Login.$setLogin(admin),BBModel.Admin.Login.$user().then(function(user){$scope.user=user,$scope.user&&($scope.template_vars.show_pick_department=!0,$scope.template_vars.show_login=!1,companySelection($scope.user))}).catch(function(err){$scope.formErrors.push({message:"GET_USER_ERROR"})})}).catch(function(err){if(400===err.status){var login=halClient.$parse(err.data);if(login.$has("administrators")){var loginModel=new BBModel.Admin.Login(login);$scope.user=loginModel,companySelection(loginModel)}else handleSSOError(err)}else handleSSOError(err)}).then(function(){$scope.template_vars.show_loading=!1}))},handleSSOError=function(err){$scope.formErrors.push({message:"ADMIN_DASHBOARD.LOGIN_PAGE.SSO_INVALID"}),AdminLoginOptions.SSOErrorHandler&&AdminLoginOptions.SSOErrorHandler(err)},formErrorExists=function(message){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=Array.from($scope.formErrors)[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){if(_step.value.message.match(message))return!0}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return!1},companySelection=function(user){if(user.$has("administrators"))return user.$getAdministrators().then(function(administrators){if($scope.administrators=administrators,administrators.length>1)$sessionStorage.setItem("multiLocationUser",!0),$scope.template_vars.show_loading=!1,$scope.template_vars.show_login=!1,$scope.template_vars.show_pick_company=!0;else{if(1===administrators.length){var params={email:$scope.login_data.email,password:$scope.login_data.password};return $scope.login_data.selected_admin=_.first(administrators),$scope.login_data.selected_admin.$post("login",{},params).then(function(login){return $scope.login_data.selected_admin.$getCompany().then(function(company){return $scope.template_vars.show_loading=!1,company.companies&&company.companies.length>0?($scope.template_vars.show_pick_department=!0,$scope.departments=company.companies):($scope.login_data.selected_company=company,BBModel.Admin.Login.$setLogin($scope.login_data.selected_admin),BBModel.Admin.Login.$setCompany($scope.login_data.selected_company.id).then(function(user){return $scope.onSuccess($scope.login_data.selected_company)}))})})}$scope.template_vars.show_loading=!1;var message="ADMIN_DASHBOARD.LOGIN_PAGE.ERROR_INCORRECT_CREDS";if(!formErrorExists(message))return $scope.formErrors.push({message:message})}});if(user.$has("company"))return $scope.login_data.selected_admin=user,user.$getCompany().then(function(company){return company.companies&&company.companies.length>0?(company.companies.length>1&&($sessionStorage.setItem("multiLocationUser",!0),$scope.multiLocationUser=!0),$scope.template_vars.show_loading=!1,$scope.template_vars.show_pick_department=!0,$scope.template_vars.show_login=!1,$scope.departments=company.companies):($scope.login_data.selected_company=company,BBModel.Admin.Login.$setLogin($scope.login_data.selected_admin),BBModel.Admin.Login.$setCompany($scope.login_data.selected_company.id).then(function(user){return $scope.onSuccess($scope.login_data.selected_company)}))},function(err){$scope.template_vars.show_loading=!1;var message="ADMIN_DASHBOARD.LOGIN_PAGE.ERROR_ISSUE_WITH_COMPANY";if(!formErrorExists(message))return $scope.formErrors.push({message:message})});if(user.$has("companies"))return user.$getCompanies().then(function(companies){if(companies&&angular.isArray(companies)&&companies.length>0)return companies.length>1?($sessionStorage.setItem("multiLocationUser",!0),$scope.template_vars.show_loading=!1,$scope.template_vars.show_pick_company=!1,$scope.template_vars.show_pick_department=!1,$scope.template_vars.show_pick_company_from_companies=!0,$scope.template_vars.show_login=!1,$scope.administrators=companies):($scope.login_data.selected_company=companies[0],BBModel.Admin.Login.$setLogin($scope.login_data.selected_company),BBModel.Admin.Login.$setCompany($scope.login_data.selected_company.company_id).then(function(user){return $scope.onSuccess($scope.login_data.selected_company)}));$scope.template_vars.show_loading=!1;var message="ADMIN_DASHBOARD.LOGIN_PAGE.ERROR_ISSUE_WITH_COMPANY";return formErrorExists(message)?void 0:$scope.formErrors.push({message:message})});$scope.template_vars.show_loading=!1;var message="ADMIN_DASHBOARD.LOGIN_PAGE.ERROR_ACCOUNT_ISSUES";return formErrorExists(message)?void 0:$scope.formErrors.push({message:message})};$scope.template_vars={show_api_field:AdminLoginOptions.show_api_field,show_login:!0,show_pick_company:!1,show_pick_department:!1,show_loading:!1},$scope.login_data={email:null,password:null,selected_admin:null,selected_company:null,site:$localStorage.getItem("api_url")},$scope.formErrors=[],$scope.login=function(isValid){if(isValid){$scope.formErrors=[],$scope.template_vars.show_loading=!0,AdminLoginOptions.show_api_field&&($scope.login_data.site=$scope.login_data.site.replace(/\/+$/,""),-1===$scope.login_data.site.indexOf("http")&&($scope.login_data.site="https://"+$scope.login_data.site),$scope.bb.api_url=$scope.login_data.site,$rootScope.bb.api_url=$scope.login_data.site,$localStorage.setItem("api_url",$scope.login_data.site));var loginParams={email:$scope.login_data.email,password:$scope.login_data.password};return BBModel.Admin.Login.$login(loginParams).then(companySelection).catch(function(err){$scope.template_vars.show_loading=!1;var message="ADMIN_DASHBOARD.LOGIN_PAGE.ERROR_INCORRECT_CREDS";if(!formErrorExists(message))return $scope.formErrors.push({message:message})})}},$scope.goToResetPassword=function(){return $state.go("reset-password")},$scope.pickCompany=function(){if($scope.template_vars.show_loading=!0,$scope.template_vars.show_pick_department=!1,!_this.ssoToken){var params={email:$scope.login_data.email,password:$scope.login_data.password};return $scope.login_data.selected_admin.$post("login",{},params).then(function(login){$scope.login_data.selected_admin.$getCompany().then(function(company){return $scope.template_vars.show_loading=!1,company.companies&&company.companies.length>0?($scope.template_vars.show_pick_department=!0,$scope.departments=company.companies):$scope.login_data.selected_company=company})})}handleSSO($scope.login_data.selected_admin.company_id)},$scope.selectCompanyDepartment=function(isValid){if($scope.template_vars.show_loading=!0,isValid)return $scope.bb.company=$scope.login_data.selected_company,$scope.template_vars.show_pick_company_from_companies?(BBModel.Admin.Login.$setLogin($scope.login_data.selected_company),BBModel.Admin.Login.$setCompany($scope.login_data.selected_company.company_id).then(function(user){return $scope.onSuccess($scope.login_data.selected_company)})):(BBModel.Admin.Login.$setLogin($scope.login_data.selected_admin),BBModel.Admin.Login.$setCompany($scope.login_data.selected_company.id).then(function(user){return $scope.onSuccess($scope.login_data.selected_company)}))},function(){_this.ssoToken=sessionStorage.getItem("sso_token")||QueryStringService("sso_token"),$sessionStorage.removeItem("multiLocationUser"),_this.ssoToken?($scope.template_vars.show_login=!1,$scope.template_vars.show_loading=!0,handleSSO()):$scope.user&&companySelection($scope.user),$scope.showPasswordResetForm=AdminLoginOptions.showPasswordResetForm}()}angular.module("BBAdminDashboard.login.directives").directive("adminDashboardLogin",function(){return{restrict:"AE",replace:!0,scope:{onSuccess:"=",onCancel:"=",onError:"=",bb:"=",user:"=?"},templateUrl:"login/admin-dashboard-login.html",controller:adminDashboardLoginCtrl}})}(angular),function(){function AdminLoginOptions(){var options={show_api_field:!1,use_default_states:!0,show_in_navigation:!0,parent_state:"root",sso_token:null,company_id:null,showPasswordResetForm:!0,SSOErrorHandler:null};this.setOption=function(option,value){options.hasOwnProperty(option)&&(options[option]=value)},this.getOption=function(option){if(options.hasOwnProperty(option))return options[option]},this.$get=function(){return options}}angular.module("BBAdminDashboard.login.services").provider("AdminLoginOptions",AdminLoginOptions)}(),angular.module("BBAdminDashboard.login.services").factory("LoggedAdmin",["AdminLoginOptions","$q",function(AdminLoginOptions,$q){var loggedAdmin={user:null,adminAccountsArray:null,departmentsArray:null,currentCompany:null};return{setUser:function(user){loggedAdmin.user=user},getUser:function(){return loggedAdmin.user},setCurrentCompany:function(company){loggedAdmin.currentCompany=company,loggedAdmin.departmentsArray=null},getCurrentCompany:function(){var deferred=$q.defer();return null!=loggedAdmin.currentCompany?(deferred.resolve(loggedAdmin.currentCompany),deferred.promise):null==loggedAdmin.user?(deferred.reject(new Error("LOGGED_ADMIN.ERROR_NO_USER_PROVIDED")),deferred.promise):(loggedAdmin.user.$has("company")&&loggedAdmin.user.getCompanyPromise().then(function(company){return loggedAdmin.currentCompany=company,deferred.resolve(loggedAdmin.currentCompany)},function(err){return deferred.reject(new Error("LOGGED_ADMIN.ERROR_ISSUE_WITH_COMPANY"))}),deferred.promise)},getAdminAccounts:function(){var deferred=$q.defer();return null!=loggedAdmin.adminAccountsArray?(deferred.resolve(loggedAdmin.adminAccountsArray),deferred.promise):null==loggedAdmin.user?(deferred.reject(new Error("LOGGED_ADMIN.ERROR_NO_USER_PROVIDED")),deferred.promise):(loggedAdmin.user.$has("administrators")?loggedAdmin.user.getAdministratorsPromise().then(function(adminAccounts){return loggedAdmin.adminAccountsArray=administrators,deferred.resolve(loggedAdmin.adminAccountsArray)},function(err){return deferred.reject(new Error("LOGGED_ADMIN.ERROR_COULD_NOT_GET_ADMINS"))}):(loggedAdmin.adminAccountsArray=[],deferred.resolve(loggedAdmin.adminAccountsArray)),deferred.promise)},getDepartments:function(){var deferred=$q.defer();return null!=loggedAdmin.departmentsArray?(deferred.resolve(loggedAdmin.departmentsArray),deferred.promise):null==loggedAdmin.user?(deferred.reject(new Error("LOGGED_ADMIN.ERROR_NO_USER_PROVIDED")),deferred.promise):(this.getCurrentCompany().then(function(company){return company.companies&&company.companies.length>0?(loggedAdmin.departmentsArray=company.companies,deferred.resolve(loggedAdmin.departmentsArray)):(loggedAdmin.departmentsArray=[],deferred.resolve(loggedAdmin.departmentsArray))},function(err){return deferred.reject(err)}),deferred.promise)}}}]),angular.module("BBAdminDashboard.login.translations").config(["$translateProvider",function($translateProvider){return $translateProvider.translations("en",{ADMIN_DASHBOARD:{LOGIN_PAGE:{COMPANIES:"Companies",DEPARTMENTS:"Departments",FORGOT_PASSWORD:"Forgot your password?",HEADING:"Login to view your account",LOGIN:" Login",PASSWORD:"Password",SITE:"Site",SEARCH_COMPANY_PLACEHOLDER:"Select or search a company in the list...",SEARCH_DEPARTMENT_PLACEHOLDER:"Select or search a department in the list...",SELECT:"Select",SELECT_COMPANY:"Select company",USERNAME:"Username",ERROR_ISSUE_WITH_COMPANY:"Sorry, there seems to be a problem with the company associated with this account",ERROR_INCORRECT_CREDS:"Sorry, either your email or password was incorrect",ERROR_ACCOUNT_ISSUES:"Sorry, there seems to be a problem with this account",ERROR_REQUIRED:"This field is required.",SSO_INVALID:"Access Denied due to incorrect user permissions. Please contact your System Administrator"}}})}]),angular.module("BBAdminDashboard.logout.controllers").controller("LogoutPageCtrl",LogoutPageCtrl),angular.module("BBAdminDashboard.members-iframe.controllers").controller("MembersIframePageCtrl",["$scope","$state","$rootScope","$window",function($scope,$state,$rootScope,$window){return $scope.parent_state=$state.is("members"),$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){if($scope.parent_state=!1,"members"===toState.name)return $scope.parent_state=!0,$scope.clearCurrentClient()}),$scope.setCurrentClient=function(client){return client?($rootScope.client_id=client,$scope.extra_params="id="+client):$scope.clearCurrentClient()},$scope.clearCurrentClient=function(){return $rootScope.client_id=null,$scope.extra_params=""},$window.addEventListener("message",function(event){if(event&&event.data&&"client"===event.data.controller&&(event.data.id&&$scope.setCurrentClient(event.data.id),"single"===event.data.action))return $state.go("members.page",{path:"client/single",id:event.data.id})})}]),angular.module("BBAdminDashboard.members-iframe.controllers").controller("MembersSubIframePageCtrl",["$scope","$state","$stateParams",function($scope,$state,$stateParams){return $scope.path=$stateParams.path,$stateParams.id?$scope.extra_params="id="+$stateParams.id:$scope.extra_params="",$scope.loading=!0,$scope.$on("iframeLoaded",function(){return $scope.loading=!1,$scope.$apply()})}]),angular.module("BBAdminDashboard.members-iframe.services").provider("AdminMembersIframeOptions",[function(){var options={use_default_states:!0,show_in_navigation:!0,parent_state:"root"};this.setOption=function(option,value){options.hasOwnProperty(option)&&(options[option]=value)},this.getOption=function(option){if(options.hasOwnProperty(option))return options[option]},this.$get=function(){return options}}]),angular.module("BBAdminDashboard.members-iframe.translations").config(["$translateProvider",function($translateProvider){return $translateProvider.translations("en",{ADMIN_DASHBOARD:{SIDE_NAV:{MEMBERS_IFRAME_PAGE:{MEMBERS:"Members",ALL_CLIENTS:"All clients",QUESTIONS:"Questions",EXPORT_TO_MAILCHIMP:"Export to Mailchimp"}}}})}]),angular.module("BBAdminDashboard.publish-iframe.controllers").controller("PublishIframePageCtrl",["$scope","$state","$rootScope",function($scope,$state,$rootScope){return $scope.parent_state=$state.is("publish"),$scope.path="conf",$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){if($scope.parent_state=!1,"setting"===toState.name)return $scope.parent_state=!0})}]),angular.module("BBAdminDashboard.publish-iframe.controllers").controller("PublishSubIframePageCtrl",["$scope","$state","$stateParams",function($scope,$state,$stateParams){return $scope.path=$stateParams.path,$scope.loading=!0,$scope.$on("iframeLoaded",function(){return $scope.loading=!1,$scope.$apply()})}]),angular.module("BBAdminDashboard.publish-iframe.services").provider("AdminPublishIframeOptions",[function(){var options={use_default_states:!0,show_in_navigation:!0,parent_state:"root"};this.setOption=function(option,value){options.hasOwnProperty(option)&&(options[option]=value)},this.getOption=function(option){if(options.hasOwnProperty(option))return options[option]},this.$get=function(){return options}}]),angular.module("BBAdminDashboard.publish-iframe.translations").config(["$translateProvider",function($translateProvider){return $translateProvider.translations("en",{ADMIN_DASHBOARD:{SIDE_NAV:{PUBLISH_IRAME_PAGE:{PUBLISH:"Publish",PUBLISH_BUSINESS:"Publish business",PUBLIC_SITE:"Public site",CUSTOMISE_WIDGETS:"Customise widgets",SINGLE_WIDGET:"Single widget",BOOK_NOW_BUTTONS:"'Book Now' buttons",OTHER_TOOLS:"Other tools"}}}})}]);var ResetPasswordCtrl=function($scope,$state,AdminLoginOptions,AdminLoginService,QueryStringService,ResetPasswordService,ResetPasswordSchemaFormService){"ngInject";var $resetPasswordCtrl=this,formErrorExists=function(message){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=Array.from($resetPasswordCtrl.formErrors)[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){if(_step.value.message.match(message))return!0}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}return!1},fetchSchemaForm=function(){ResetPasswordSchemaFormService.getSchemaForm($scope.baseUrl).then(function(response){return $resetPasswordCtrl.resetPasswordSchema=angular.copy(response.data.schema),ResetPasswordSchemaFormService.setPasswordPattern($resetPasswordCtrl.resetPasswordSchema.properties.password.pattern),$resetPasswordCtrl.reset_password_pattern=ResetPasswordSchemaFormService.getPasswordPattern()},function(err){return ResetPasswordSchemaFormService.setPasswordPattern("^(?=[^\\s]*[^a-zA-Z])(?=[^\\s]*[a-zA-Z])[^\\s]{7,25}$"),$resetPasswordCtrl.reset_password_pattern=ResetPasswordSchemaFormService.getPasswordPattern()})};$resetPasswordCtrl.goBackToLogin=function(){$state.go("login")},$resetPasswordCtrl.sendResetPassword=function(email,resetPasswordSite){$resetPasswordCtrl.showLoading=!0,$resetPasswordCtrl.showApiField&&""!==resetPasswordSite&&($resetPasswordCtrl.resetPasswordSite=resetPasswordSite.replace(/\/+$/,""),-1===$resetPasswordCtrl.resetPasswordSite.indexOf("http")&&($resetPasswordCtrl.resetPasswordSite="https://"+$resetPasswordCtrl.resetPasswordSite),$scope.baseUrl=$resetPasswordCtrl.resetPasswordSite),ResetPasswordService.postRequest(email,$scope.baseUrl).then(function(response){return $resetPasswordCtrl.resetPasswordSuccess=!0,$resetPasswordCtrl.showLoading=!1},function(err){$resetPasswordCtrl.resetPasswordSuccess=!1,$resetPasswordCtrl.showLoading=!1;var message="ADMIN_DASHBOARD.RESET_PASSWORD_PAGE.FORM_SUBMIT_FAIL_MSG";if(!formErrorExists(message))return $resetPasswordCtrl.formErrors.push({message:message})})},$resetPasswordCtrl.submitSchemaForm=function(password){$resetPasswordCtrl.showLoading=!0,ResetPasswordSchemaFormService.postSchemaForm(password,$scope.baseUrl).then(function(response){$resetPasswordCtrl.resetPasswordSuccess=!0;var loginForm={email:response.data.email,password:password};return AdminLoginService.login(loginForm).then(function(response){return $state.go("login")},function(err){return $resetPasswordCtrl.showLoading=!1,$resetPasswordCtrl.formErrors.push({message:"ADMIN_DASHBOARD.LOGIN_PAGE.ERROR_ISSUE_WITH_COMPANY"})})},function(err){$resetPasswordCtrl.resetPasswordSuccess=!1,$resetPasswordCtrl.showLoading=!1;var message="ADMIN_DASHBOARD.RESET_PASSWORD_PAGE.FORM_SUBMIT_FAIL_MSG";if(!formErrorExists(message))return $resetPasswordCtrl.formErrors.push({message:message})})},function(){null==$scope.baseUrl&&($scope.baseUrl=$resetPasswordCtrl.resetPasswordSite),$resetPasswordCtrl.showApiField=AdminLoginOptions.show_api_field,$resetPasswordCtrl.resetPasswordSuccess=!1,$resetPasswordCtrl.showLoading=!1,$resetPasswordCtrl.showApiField&&($resetPasswordCtrl.resetPasswordSite=angular.copy($scope.bb.api_url)),$resetPasswordCtrl.formErrors=[],null!=QueryStringService("reset_password_token")&&"undefined"!==QueryStringService("reset_password_token")&&""!==QueryStringService("reset_password_token")?($resetPasswordCtrl.resetPasswordTemplate="reset-password/reset-password-by-token.html",fetchSchemaForm()):$resetPasswordCtrl.resetPasswordTemplate="reset-password/reset-password.html"}()};angular.module("BBAdminDashboard.reset-password").controller("ResetPasswordCtrl",ResetPasswordCtrl);var ResetPasswordPageCtrl=function($scope){"ngInject";!function(){null!=$scope.bb.api_url&&""!==$scope.bb.api_url&&($scope.baseUrl=angular.copy($scope.bb.api_url))}()};angular.module("BBAdminDashboard.reset-password").controller("ResetPasswordPageCtrl",ResetPasswordPageCtrl);var adminDashboardResetPassword=function(){return{restrict:"AE",replace:!0,scope:!0,template:'<div ng-include="$resetPasswordCtrl.resetPasswordTemplate"></div>',controller:"ResetPasswordCtrl",controllerAs:"$resetPasswordCtrl"}};angular.module("BBAdminDashboard.reset-password").directive("adminDashboardResetPassword",adminDashboardResetPassword);var ResetPasswordSchemaFormService=function($q,$http,QueryStringService){"ngInject";return{setPasswordPattern:function(pattern){return pattern},getPasswordPattern:function(){return""},getSchemaForm:function(baseUrl){var deferred=$q.defer(),src=baseUrl+"/api/v1/login/admin/reset_password_schema";return $http.get(src,{}).then(function(response){return deferred.resolve(response)},function(err){return deferred.reject(err)}),deferred.promise},postSchemaForm:function(password,baseUrl){var deferred=$q.defer(),src=baseUrl+"/api/v1/login/admin/reset_password",resetPasswordToken=QueryStringService("reset_password_token"),body={password:password,reset_password_token:resetPasswordToken};return $http.put(src,body).then(function(response){return deferred.resolve(response)},function(err){return deferred.reject(err)}),deferred.promise}}};angular.module("BBAdminDashboard.reset-password").factory("ResetPasswordSchemaFormService",ResetPasswordSchemaFormService);var ResetPasswordService=function($q,$window,$http){"ngInject";return{postRequest:function(email,baseUrl){var deferred=$q.defer(),url=baseUrl+"/api/v1/login/admin/reset_password_email",path=$window.location.pathname+"#/reset-password",body={email:email,path:path};return $http.post(url,body).then(function(response){return deferred.resolve(response)},function(err){return deferred.reject(err)}),deferred.promise}}};angular.module("BBAdminDashboard.reset-password").factory("ResetPasswordService",ResetPasswordService),angular.module("BBAdminDashboard.reset-password").config(["$translateProvider",function($translateProvider){return $translateProvider.translations("en",{ADMIN_DASHBOARD:{RESET_PASSWORD_PAGE:{BACK_BTN:"Back",CONFIRM_NEW_PASSWORD_LBL:"Confirm New Password",EMAIL_LBL:"Email",ENTER_NEW_PASSWORD:"Enter your new password",ENTER_EMAIL:"Enter your email address",ERROR_API_MISSING:"API url has not been set correctly.",ERROR_EMAIL_INVALID:"Please enter a valid email.",ERROR_PASSWORD_MATCH:"This needs to be the same as the new password.",ERROR_PASSWORD_PATTERN:"Password must be between 7 and 25 characters and contain at least one letter and one number.",ERROR_REQUIRED:"This field is required.",FORGOT_PASSWORD:"Forgot your password?",FORM_SUBMIT_FAIL:"Password Reset request failed",FORM_SUBMIT_SUCCESS:"Password Reset request submitted",FORM_SUBMIT_FAIL_MSG:"Sorry we couldn't update your password successfully. Please try again or contact our support team.",FORM_SUBMIT_SUCCESS_MSG:"Thank you for resetting your password. You will receive an email shortly with instructions to complete this process.",NEW_PASSWORD_LBL:"New Password",PASSWORD:"Password",PASSWORD_RESET_SUCCESS:"Password Reset complete",PASSWORD_RESET_SUCCESS_MSG:"Your password has now been successfully updated.",RESET_PASSWORD_BTN:"Reset Password",SITE_LBL:"Site"}}})}]),angular.module("BBAdminDashboard.settings-iframe.controllers").controller("SettingsIframeAdvancedSettingsPageCtrl",["$scope","$state","$rootScope",function($scope,$state,$rootScope){return $scope.pageHeader="ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.ADVANCED_SETTINGS.TITLE",$scope.tabs=[{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.ADVANCED_SETTINGS.TAB_ONLINE_PAYMENTS",icon:"fa fa-credit-card",path:'settings.advanced-settings.page({path: "conf/payment/payment_edit"})'},{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.ADVANCED_SETTINGS.TAB_ACCOUNTING_INTEGRATIONS",icon:"fa fa-pencil-square-o",path:'settings.advanced-settings.page({path: "conf/accounting/accounting_integration"})'},{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.ADVANCED_SETTINGS.TAB_BUSINESS_QUESTIONS",icon:"fa fa-question",path:'settings.advanced-settings.page({path: "conf/extra_question"})'},{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.ADVANCED_SETTINGS.TAB_API_SETTINGS",icon:"fa fa-code",path:'settings.advanced-settings.page({path: "conf/developer/parameter"})'}],$scope.contentsLoading=!1,$scope.$on("iframeLoaded",function(){return $scope.contentsLoading=!1,$scope.$apply()}),$scope.$on("iframeLoading",function(){return $scope.contentsLoading=!0})}]),angular.module("BBAdminDashboard.settings-iframe.controllers").controller("SettingsIframeBasicSettingsPageCtrl",["$scope","$state","$rootScope",function($scope,$state,$rootScope){return $scope.pageHeader="ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.BASIC_SETTINGS.TITLE",$scope.tabs=[{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.BASIC_SETTINGS.TAB_BUSINESS",icon:"fa fa-globe",path:'settings.basic-settings.page({path: "conf/setting/user_edit"})'},{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.BASIC_SETTINGS.TAB_SERVICES",icon:"fa fa-wrench",path:'settings.basic-settings.page({path: "conf/setting/service_edit"})'},{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.BASIC_SETTINGS.TAB_EVENTS",icon:"fa fa-ticket",path:'settings.basic-settings.page({path: "conf/setting/session_edit"})'},{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.BASIC_SETTINGS.TAB_RESOURCES",icon:"fa fa-archive",path:'settings.basic-settings.page({path: "conf/setting/resource_edit"})'},{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.BASIC_SETTINGS.TAB_WIDGET",icon:"fa fa-calendar-times-o",path:'settings.basic-settings.page({path: "conf/setting/widget_edit"})'},{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.BASIC_SETTINGS.TAB_BOOKINGS",icon:"fa fa-book",path:'settings.basic-settings.page({path: "conf/setting/booking_edit"})'},{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.BASIC_SETTINGS.TAB_NOTIFICATIONS",icon:"fa fa-envelope",path:'settings.basic-settings.page({path: "conf/setting/notifier_edit"})'},{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.BASIC_SETTINGS.TAB_PRICING",icon:"fa fa-credit-card",path:'settings.basic-settings.page({path: "conf/setting/pricing_edit"})'},{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.BASIC_SETTINGS.TAB_TERMINOLOGY",icon:"fa fa-language",path:'settings.basic-settings.page({path: "conf/language/user_edit"})'},{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.BASIC_SETTINGS.TAB_CUSTOM_TCS",icon:"fa fa-pencil-square-o",path:'settings.basic-settings.page({path: "conf/text/terms_conditions"})'},{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.BASIC_SETTINGS.TAB_EXTRA_FEATURES",icon:"fa fa-trophy",path:'settings.basic-settings.page({path: "conf/setting/features_edit"})'}],$scope.contentsLoading=!1,$scope.$on("iframeLoaded",function(){return $scope.contentsLoading=!1,$scope.$apply()}),$scope.$on("iframeLoading",function(){return $scope.contentsLoading=!0})}]),angular.module("BBAdminDashboard.settings-iframe.controllers").controller("SettingsIframeIntegrationsPageCtrl",["$scope","$state","$rootScope",function($scope,$state,$rootScope){return $scope.pageHeader="ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.INTEGRATIONS.TITLE",$scope.tabs=[{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.INTEGRATIONS.TAB_PAYMENT",icon:"fa fa-credit-card",path:'settings.integrations.page({path: "conf/addons/payment"})'},{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.INTEGRATIONS.TAB_ACCOUNTING",icon:"fa fa-pencil-square-o",path:'settings.integrations.page({path: "conf/addons/accounting"})'},{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.INTEGRATIONS.TAB_OTHER",icon:"fa fa-question",path:'settings.integrations.page({path: "conf/addons/other"})'}],$scope.contentsLoading=!1,$scope.$on("iframeLoaded",function(){return $scope.contentsLoading=!1,$scope.$apply()}),$scope.$on("iframeLoading",function(){return $scope.contentsLoading=!0})}]),angular.module("BBAdminDashboard.settings-iframe.controllers").controller("SettingsIframePageCtrl",["$scope","$state","$rootScope",function($scope,$state,$rootScope){return $scope.parent_state=$state.is("setting"),$scope.path="conf",$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){if($scope.parent_state=!1,"setting"===toState.name)return $scope.parent_state=!0})}]),angular.module("BBAdminDashboard.settings-iframe.controllers").controller("SettingsIframeSubscriptionPageCtrl",["$scope","$state","$rootScope",function($scope,$state,$rootScope){return $scope.pageHeader="ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.SUBSCRIPTION.TITLE",$scope.tabs=[{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.SUBSCRIPTION.TAB_STATUS",icon:null,path:'settings.subscription.page({path: "subscription/show"})'},{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.SUBSCRIPTION.TAB_PAYMENT_HISTORY",icon:null,path:'settings.subscription.page({path: "payment_event"})'},{name:"ADMIN_DASHBOARD.SETTINGS_IFRAME_PAGE.SUBSCRIPTION.TAB_INVOICES",icon:null,path:'settings.subscription.page({path: "payment_invoice"})'}],$scope.contentsLoading=!1,$scope.$on("iframeLoaded",function(){return $scope.contentsLoading=!1,$scope.$apply()}),$scope.$on("iframeLoading",function(){return $scope.contentsLoading=!0})}]),angular.module("BBAdminDashboard.settings-iframe.controllers").controller("SettingsSubIframePageCtrl",["$scope","$state","$stateParams",function($scope,$state,$stateParams){return $scope.path=$stateParams.path,$stateParams.id?$scope.extra_params="id="+$stateParams.id:$scope.extra_params="",$scope.pageHeader=null,$scope.$emit("iframeLoading",{}),$scope.onIframeLoad=function(){return $scope.$emit("iframeLoaded",{})},$scope.loading=!0,$scope.$on("iframeLoaded",function(){return $scope.loading=!1,$scope.$apply()})}]),angular.module("BBAdminDashboard.settings-iframe.services").provider("AdminSettingsIframeOptions",[function(){var options={use_default_states:!0,show_in_navigation:!0,parent_state:"root"};this.setOption=function(option,value){options.hasOwnProperty(option)&&(options[option]=value)},this.getOption=function(option){if(options.hasOwnProperty(option))return options[option]},this.$get=function(){return options}}]),angular.module("BBAdminDashboard.settings-iframe.translations").config(["$translateProvider",function($translateProvider){return $translateProvider.translations("en",{ADMIN_DASHBOARD:{SIDE_NAV:{SETTINGS_IFRAME_PAGE:{ACCOUNT_SETTINGS:"Account settings",MY_BUSINESS:"My business",BASIC_SETTINGS:"Basic settings",ADVANCED_SETTINGS:"Advanced settings",INTEGRATIONS:"Integrations",IMAGES:"Images",USERS_ADMINS:"Users & Admins",ANNOUNCEMENTS:"Announcements",SUBSCRIPTION:"Subscription"}},SETTINGS_IFRAME_PAGE:{BASIC_SETTINGS:{TITLE:"Settings",TAB_BUSINESS:"Business",TAB_SERVICES:"Services",TAB_STAFF:"Staff",TAB_EVENTS:"Events",TAB_RESOURCES:"Resources",TAB_WIDGET:"Widget",TAB_BOOKINGS:"Bookings",TAB_NOTIFICATIONS:"Notifications",TAB_PRICING:"Pricing",TAB_TERMINOLOGY:"Terminology",TAB_CUSTOM_TCS:"Custom T&Cs",TAB_EXTRA_FEATURES:"Extra features"},ADVANCED_SETTINGS:{TITLE:"Advanced settings",TAB_ONLINE_PAYMENTS:"Online payments",TAB_ACCOUNTING_INTEGRATIONS:"Accounting Integrations",TAB_BUSINESS_QUESTIONS:"Business Questions",TAB_API_SETTINGS:"API settings"},INTEGRATIONS:{TITLE:"Integrations",TAB_PAYMENT:"Payment",TAB_ACCOUNTING:"Accounting",TAB_OTHER:"Other"},SUBSCRIPTION:{TITLE:"Subscription",TAB_STATUS:"Status",TAB_PAYMENT_HISTORY:"Payment history",TAB_INVOICES:"Invoices"}}}})}]),function(){function bbNewBookingCtrl(AdminBookingPopup,AdminBookingOptions){var _this=this;this.newBooking=function(){AdminBookingPopup.open({item_defaults:{day_view:AdminBookingOptions.day_view,merge_people:!0,merge_resources:!0},client:_this.client,company_id:_this.companyId,on_conflict:"cancel()",template:"main",hide_block:!0,title:"ADMIN_DASHBOARD.MODAL.NEW_BOOKING_HEADER"})}}angular.module("BBAdminDashboard.calendar").component("bbNewBooking",{templateUrl:"core/new_booking_button.html",bindings:{client:"<",companyId:"<"},controller:bbNewBookingCtrl,controllerAs:"$bbNewBookingCtrl"})}();