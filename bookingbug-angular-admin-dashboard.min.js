(function(){"use strict";angular.module("BBAdminDashboard.calendar.controllers",[]),angular.module("BBAdminDashboard.calendar.services",[]),angular.module("BBAdminDashboard.calendar.directives",[]),angular.module("BBAdminDashboard.calendar",["BBAdminDashboard.calendar.controllers","BBAdminDashboard.calendar.services","BBAdminDashboard.calendar.directives"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){return $stateProvider.state("calendar",{parent:"root",url:"/calendar/:assets",templateUrl:"calendar_page.html",controller:"CalendarPageCtrl"})}])}).call(this),function(){"use strict";angular.module("BBAdminDashboard.check-in.controllers",[]),angular.module("BBAdminDashboard.check-in.services",[]),angular.module("BBAdminDashboard.check-in.directives",[]),angular.module("BBAdminDashboard.check-in",["BBAdminDashboard.check-in.controllers","BBAdminDashboard.check-in.services","BBAdminDashboard.check-in.directives"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){return $stateProvider.state("checkin",{parent:"root",url:"/check-in",templateUrl:"checkin_page.html",controller:"CheckInPageCtrl"})}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.clients.controllers",[]),angular.module("BBAdminDashboard.clients.services",[]),angular.module("BBAdminDashboard.clients.directives",[]),angular.module("BBAdminDashboard.clients",["BBAdminDashboard.clients.controllers","BBAdminDashboard.clients.services","BBAdminDashboard.clients.directives"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){return $stateProvider.state("clients",{parent:"root",url:"/clients",templateUrl:"admin_clients.html",controller:"ClientsPageCtrl"}).state("clients.new",{url:"/new",templateUrl:"client_new.html",controller:"ClientsNewPageCtrl"}).state("clients.all",{url:"/all",templateUrl:"all_clients.html",controller:"ClientsAllPageCtrl"}).state("clients.edit",{url:"/edit/:id",templateUrl:"admin_client.html",resolve:{client:function(company,$stateParams,AdminClientService){var params;return params={company_id:company.id,id:$stateParams.id},AdminClientService.query(params)}},controller:"ClientsEditPageCtrl"})}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.config-iframe.controllers",[]),angular.module("BBAdminDashboard.config-iframe.services",[]),angular.module("BBAdminDashboard.config-iframe.directives",[]),angular.module("BBAdminDashboard.config-iframe",["BBAdminDashboard.config-iframe.controllers","BBAdminDashboard.config-iframe.services","BBAdminDashboard.config-iframe.directives"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){return $stateProvider.state("config",{parent:"root",url:"/config",templateUrl:"admin_config_page.html",controller:"ConfigIframePageCtrl"}).state("config.page",{url:"/page/:path",templateUrl:"iframe_page.html",controller:"ConfigSubIframePageCtrl"})}])}.call(this),function(){"use strict";var BBAdminDashboardDependencies,adminBookingApp;angular.module("BBAdminDashboard.controllers",[]),angular.module("BBAdminDashboard.filters",[]),angular.module("BBAdminDashboard.services",[]),angular.module("BBAdminDashboard.directives",[]),BBAdminDashboardDependencies=["ngStorage","ngResource","ngTouch","ngSanitize","ngIdle","ngLocalData","ngInputDate","BBAdmin","BBAdminServices","BBAdminBooking","BBAdmin.Directives","ui.calendar","ui.bootstrap","ui.router","ui.select","ct.ui.router.extras","trNgGrid","xeditable","toggle-switch","BBAdminDashboard.controllers","BBAdminDashboard.filters","BBAdminDashboard.services","BBAdminDashboard.directives","BBAdminDashboard.check-in","BBAdminDashboard.clients","BBAdminDashboard.departments","BBAdminDashboard.login","BBAdminDashboard.logout","BBAdminDashboard.calendar","BBAdminDashboard.dashboard-iframe","BBAdminDashboard.members-iframe","BBAdminDashboard.settings-iframe","BBAdminDashboard.config-iframe","BBAdminDashboard.publish-iframe"],adminBookingApp=angular.module("BBAdminDashboard",BBAdminDashboardDependencies).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){return $stateProvider.root_state="dashboard",$urlRouterProvider.otherwise("/"+$stateProvider.root_state),$stateProvider.state("root",{template:"<div ui-view></div>",resolve:{sso:function($q,sso_token,AdminLoginService,$injector){var defer;return defer=$q.defer(),AdminLoginService.isLoggedIn().then(function(loggedIn){var AdminSsoLogin;return loggedIn||sso_token===!1?defer.resolve():(AdminSsoLogin=$injector.get("AdminSsoLogin"))(sso_token,function(admin){return AdminLoginService.setLogin(admin),defer.resolve()})}),defer.promise},user:function($q,AdminLoginService,$timeout,$state,sso){var defer;return defer=$q.defer(),AdminLoginService.user().then(function(user){return user?defer.resolve(user):$timeout(function(){return $state.go("login",{},{reload:!0})})},function(err){return $timeout(function(){return $state.go("login",{},{reload:!0})})}),defer.promise},company:function(user,$q,$timeout,$state){var defer;return defer=$q.defer(),user.getCompanyPromise().then(function(company){return company.companies&&company.companies.length>0?$timeout(function(){return $state.go("departments",{},{reload:!0})}):defer.resolve(company)},function(err){return $timeout(function(){return console.log("failed to get company"),$state.go("login",{},{reload:!0})})}),defer.promise}},controller:"CorePageController"})}]).config(function($logProvider,$httpProvider){return $logProvider.debugEnabled(!0),$httpProvider.defaults.withCredentials=!0}).constant("idleTimeout",600).constant("idleStart",300).value("company_id",null).value("sso_token",!1).config(function($idleProvider,idleStart,idleTimeout){return $idleProvider.idleDuration(idleStart),$idleProvider.warningDuration(idleTimeout)})}.call(this),function(){"use strict";angular.module("BBAdminDashboard.dashboard-iframe.controllers",[]),angular.module("BBAdminDashboard.dashboard-iframe.services",[]),angular.module("BBAdminDashboard.dashboard-iframe.directives",[]),angular.module("BBAdminDashboard.dashboard-iframe",["BBAdminDashboard.dashboard-iframe.controllers","BBAdminDashboard.dashboard-iframe.services","BBAdminDashboard.dashboard-iframe.directives"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){return $stateProvider.state("dashboard",{parent:"root",url:"/dashboard",controller:"DashboardIframePageCtrl",templateUrl:"admin_dashboard_page.html"}).state("dashboard.page",{parent:"dashboard",url:"/page/:path",controller:"DashboardSubIframePageCtrl",templateUrl:"iframe_page.html"})}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.departments.controllers",[]),angular.module("BBAdminDashboard.departments.services",[]),angular.module("BBAdminDashboard.departments.directives",[]),angular.module("BBAdminDashboard.departments",["BBAdminDashboard.departments.controllers","BBAdminDashboard.departments.services","BBAdminDashboard.departments.directives"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){return $stateProvider.state("departments",{url:"/departments",templateUrl:"admin_departments_page.html",resolve:{user:function($q,AdminLoginService,$timeout,$state){var defer;return defer=$q.defer(),AdminLoginService.user().then(function(user){return user?defer.resolve(user):$timeout(function(){return $state.go("login",{},{reload:!0})})},function(err){return $timeout(function(){return $state.go("login",{},{reload:!0})})}),defer.promise},company:function(user){return user.getCompanyPromise()},departments:function(company,$q,$timeout,$state){var defer;return defer=$q.defer(),company.companies&&company.companies.length>0?defer.resolve(company.companies):$timeout(function(){return $state.go($stateProvider.root_state,{},{reload:!0})}),defer.promise}},controller:"DepartmentsPageCtrl"})}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.login.controllers",[]),angular.module("BBAdminDashboard.login.services",[]),angular.module("BBAdminDashboard.login.directives",[]),angular.module("BBAdminDashboard.login",["BBAdminDashboard.login.controllers","BBAdminDashboard.login.services","BBAdminDashboard.login.directives"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){return $stateProvider.state("login",{url:"/login",controller:"LoginPageCtrl",templateUrl:"admin_login_page.html"})}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.logout.controllers",[]),angular.module("BBAdminDashboard.logout.services",[]),angular.module("BBAdminDashboard.logout.directives",[]),angular.module("BBAdminDashboard.logout",["BBAdminDashboard.logout.controllers","BBAdminDashboard.logout.services","BBAdminDashboard.logout.directives"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){return $stateProvider.state("logout",{url:"/logout",controller:"LogoutPageCtrl"})}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.members-iframe.controllers",[]),angular.module("BBAdminDashboard.members-iframe.services",[]),angular.module("BBAdminDashboard.members-iframe.directives",[]),angular.module("BBAdminDashboard.members-iframe",["BBAdminDashboard.members-iframe.controllers","BBAdminDashboard.members-iframe.services","BBAdminDashboard.members-iframe.directives"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){return $stateProvider.state("members",{parent:"root",url:"/members",templateUrl:"admin_members_page.html",controller:"MembersIframePageCtrl"}).state("members.page",{parent:"members",url:"/page/:path/:id",templateUrl:"iframe_page.html",controller:"MembersSubIframePageCtrl"})}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.publish-iframe.controllers",[]),angular.module("BBAdminDashboard.publish-iframe.services",[]),angular.module("BBAdminDashboard.publish-iframe.directives",[]),angular.module("BBAdminDashboard.publish-iframe",["BBAdminDashboard.publish-iframe.controllers","BBAdminDashboard.publish-iframe.services","BBAdminDashboard.publish-iframe.directives"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){return $stateProvider.state("publish",{parent:"root",url:"/publish",templateUrl:"admin_publish_page.html",controller:"PublishIframePageCtrl"}).state("publish.page",{parent:"publish",url:"/page/:path",templateUrl:"iframe_page.html",controller:"PublishSubIframePageCtrl"})}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.settings-iframe.controllers",[]),angular.module("BBAdminDashboard.settings-iframe.services",[]),angular.module("BBAdminDashboard.settings-iframe.directives",[]),angular.module("BBAdminDashboard.settings-iframe",["BBAdminDashboard.settings-iframe.controllers","BBAdminDashboard.settings-iframe.services","BBAdminDashboard.settings-iframe.directives"]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){return $stateProvider.state("settings",{parent:"root",url:"/settings",templateUrl:"admin_settings_page.html",deepStateRedirect:{"default":{state:"settings.page",params:{path:"person"}},params:!0}}).state("settings.page",{parent:"settings",url:"/page/:path",templateUrl:"iframe_page.html",controller:"SettingsSubIframePageCtrl"})}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.calendar.controllers").controller("CalendarPageCtrl",["$scope","$state",function($scope,$state){return $scope.adminlte.side_menu=!1,$scope.adminlte.heading=null}])}.call(this),function(){angular.module("BBAdminDashboard.calendar.directives").directive("bbResourceCalendar",function(uiCalendarConfig,AdminCompanyService,AdminBookingService,AdminPersonService,$q,$sessionStorage,ModalForm,BBModel,AdminBookingPopup,$window,$bbug,ColorPalette,AppConfig,Dialog,$timeout,$compile,$templateCache,BookingCollections,PrePostTime,AdminScheduleService,$filter){var controller,link;return controller=function($scope,$attrs,BBAssets,ProcessAssetsFilter,$state,GeneralOptions){var bookingBelongsToSelectedResource,filters,height,labelAssembly,pusherBooking;return filters={requestedAssets:ProcessAssetsFilter($state.params.assets)},$scope.eventSources=[{events:function(start,end,timezone,callback){return $scope.loading=!0,$scope.getCompanyPromise().then(function(company){var params;return params={company:company,start_date:start.format("YYYY-MM-DD"),end_date:end.format("YYYY-MM-DD"),skip_cache:!0},AdminBookingService.query(params).then(function(bookings){var b,filteredBookings,i,len,ref;for($scope.loading=!1,filteredBookings=[],ref=bookings.items,i=0,len=ref.length;len>i;i++)b=ref[i],b.resourceId=b.person_id,b.useFullTime(),b.title=labelAssembly(b),$scope.showAll?filteredBookings.push(b):!$scope.showAll&&bookingBelongsToSelectedResource(b)&&filteredBookings.push(b);return $scope.bookings=filteredBookings,callback($scope.bookings)})})}},{events:function(start,end,timezone,callback){return $scope.loading=!0,$scope.getCompanyPromise().then(function(company){return AdminScheduleService.getAssetsScheduleEvents(company,start,end,!$scope.showAll,$scope.selectedResources.selected).then(function(availabilities){var overAllAvailabilities;return"timelineDay"===uiCalendarConfig.calendars.resourceCalendar.fullCalendar("getView").type?($scope.loading=!1,callback(availabilities)):(overAllAvailabilities=[],angular.forEach(availabilities,function(availability,index){var dayAvailability;return dayAvailability=_.filter(overAllAvailabilities,function(overAllAvailability){return overAllAvailability.start.dayOfYear()===moment(availability.start).dayOfYear()?!0:!1}),dayAvailability.length>0?(moment(availability.start).unix()<dayAvailability[0].start.unix()&&(dayAvailability[0].start=moment(availability.start)),moment(availability.end).unix()>dayAvailability[0].end.unix()?dayAvailability[0].end=moment(availability.end):void 0):overAllAvailabilities.push({start:moment(availability.start),end:moment(availability.end),rendering:"background",title:"Joined availability "+moment(availability.start).format("YYYY-MM-DD")})}),$scope.loading=!1,callback(overAllAvailabilities))})})}}],bookingBelongsToSelectedResource=function(booking){var belongs;return belongs=!1,_.each($scope.selectedResources.selected,function(asset){return parseInt(asset.id)===parseInt(booking.person_id)||parseInt(asset.id)===parseInt(booking.resourceId)?belongs=!0:void 0}),belongs},labelAssembly=function(event){var i,index,label,len,match,myRe,parts,ref,replaceWith;if(null==$scope.labelAssembler&&3!==event.status||null==$scope.blockLabelAssembler&&3===event.status)return event.title;for(myRe=new RegExp("\\{([a-zA-z_-]+)\\|?([a-zA-z_-]+)?:?([a-zA-z0-9{}_-]+)?\\}","g"),label=3===event.status?$scope.blockLabelAssembler:$scope.labelAssembler,ref=$scope.labelAssembler.match(myRe),index=i=0,len=ref.length;len>i;index=++i)match=ref[index],parts=match.split(myRe),parts.splice(0,1),parts.pop(),event.hasOwnProperty(parts[0])?(replaceWith=event[parts[0]],null!=parts[1]&&null!=$filter(parts[1])&&(replaceWith=null!=parts[2]?$filter(parts[1])(replaceWith,$scope.$eval(parts[2])):$filter(parts[1])(replaceWith)),label=label.replace(match,replaceWith)):label=label.replace(match,"");return label},$scope.options=$scope.$eval($attrs.bbResourceCalendar),$scope.options||($scope.options={}),height=$scope.options.header_height?$bbug($window).height()-$scope.options.header_height:800,null==$scope.options.min_time&&($scope.options.min_time=GeneralOptions.calendar_min_time),null==$scope.options.max_time&&($scope.options.max_time=GeneralOptions.calendar_max_time),null==$scope.options.cal_slot_duration&&($scope.options.cal_slot_duration=GeneralOptions.calendar_slot_duration),$scope.uiCalOptions={calendar:{schedulerLicenseKey:"0598149132-fcs-1443104297",eventStartEditable:!0,eventDurationEditable:!1,minTime:$scope.options.min_time,maxTime:$scope.options.max_time,height:height,header:{left:"today,prev,next",center:"title",right:"timelineDay,timelineDayThirty,agendaWeek,month"},defaultView:"timelineDay",views:{agendaWeek:{slotDuration:$filter("minutesToString")($scope.options.cal_slot_duration),buttonText:"Week",groupByDateAndResource:!1},month:{eventLimit:5,buttonText:"Month"},timelineDay:{slotDuration:$filter("minutesToString")($scope.options.cal_slot_duration),eventOverlap:!1,slotWidth:25,buttonText:"Day ("+$scope.options.cal_slot_duration+"m)",resourceAreaWidth:"18%"}},resourceLabelText:"Staff",selectable:!0,resources:function(callback){return $scope.getCalendarAssets(callback)},eventDrop:function(event,delta,revertFunc){return Dialog.confirm({model:event,body:"Are you sure you want to move this booking?",success:function(_this){return function(model){return $scope.updateBooking(event)}}(this),fail:function(){return revertFunc()}})},eventClick:function(event,jsEvent,view){return $scope.editBooking(event)},eventRender:function(event,element){var service;return 3===event.status&&element.find(".fc-bg").css({"background-color":"#000"}),service=_.findWhere($scope.services,{id:event.service_id}),service?(element.css("background-color",service.color),element.css("color",service.textColor),element.css("border-color",service.textColor)):void 0},eventAfterRender:function(event,elements,view){return PrePostTime.apply(event,elements,view,$scope),null==event.rendering||"background"!==event.rendering?elements.draggable():void 0},select:function(start,end,jsEvent,view,resource){var rid,setTimeToMoment;return setTimeToMoment=function(date,time){var newDate;return newDate=moment(time,"HH:mm"),newDate.set({year:parseInt(date.get("year")),month:parseInt(date.get("month")),date:parseInt(date.get("date")),second:0}),newDate},Math.abs(start.diff(end,"days"))>0&&(end.subtract(1,"days"),end=setTimeToMoment(end,$scope.options.max_time)),view.calendar.unselect(),rid=null,resource&&(rid=resource.id),$scope.getCompanyPromise().then(function(company){return AdminBookingPopup.open({min_date:setTimeToMoment(start,$scope.options.min_time),max_date:setTimeToMoment(end,$scope.options.max_time),from_datetime:start,to_datetime:end,item_defaults:{date:start.format("YYYY-MM-DD"),time:60*start.hour()+start.minute(),person:rid},first_page:"quick_pick",company_id:company.id})})},viewRender:function(view,element){var date;return date=uiCalendarConfig.calendars.resourceCalendar.fullCalendar("getDate"),$scope.currentDate=date.format()},eventResize:function(event,delta,revertFunc,jsEvent,ui,view){return event.duration=event.end.diff(event.start,"minutes"),$scope.updateBooking(event)},loading:function(isLoading,view){return $scope.calendarLoading=isLoading}}},$scope.getCompanyPromise=function(){var defer;return defer=$q.defer(),$scope.company?defer.resolve($scope.company):AdminCompanyService.query($attrs).then(function(company){return $scope.company=company,defer.resolve($scope.company)}),defer.promise},$scope.assets=[],$scope.showAll=!0,$scope.selectedResources={selected:[]},$scope.changeSelectedResources=function(){return $scope.showAll&&($scope.selectedResources.selected=[]),uiCalendarConfig.calendars.resourceCalendar.fullCalendar("refetchResources"),uiCalendarConfig.calendars.resourceCalendar.fullCalendar("refetchEvents")},$scope.getCompanyPromise().then(function(company){return $scope.loading=!0,BBAssets(company).then(function(assets){return $scope.loading=!1,$scope.assets=assets,filters.requestedAssets.length>0?($scope.showAll=!1,angular.forEach($scope.assets,function(asset){var isInArray;return isInArray=_.find(filters.requestedAssets,function(id){return parseInt(id)===asset.id}),"undefined"!=typeof isInArray?$scope.selectedResources.selected.push(asset):void 0}),$scope.changeSelectedResources()):void 0})}),$scope.$watch("selectedResources.selected",function(newValue,oldValue){var assets,params;return newValue!==oldValue?(assets=[],angular.forEach(newValue,function(asset){return assets.push(asset.id)}),params=$state.params,params.assets=assets.join(),$state.go($state.current.name,params,{notify:!1,reload:!1})):void 0}),$scope.getCalendarAssets=function(callback){return $scope.loading=!0,$scope.getCompanyPromise().then(function(company){return $scope.showAll?BBAssets(company).then(function(assets){return $scope.loading=!1,callback($scope.assets)}):($scope.loading=!1,callback($scope.selectedResources.selected))})},$scope.updateBooking=function(booking){return booking.person_id=booking.resourceId,booking.$update().then(function(response){return booking.resourceId=booking.person_id,uiCalendarConfig.calendars.resourceCalendar.fullCalendar("updateEvent",booking)})},$scope.editBooking=function(booking){var templateUrl,title;return 3===booking.status?(templateUrl="edit_block_modal_form.html",title="Edit Block"):(templateUrl="edit_booking_modal_form.html",title="Edit Booking"),ModalForm.edit({templateUrl:templateUrl,model:booking,title:title,success:function(_this){return function(response){return response.is_cancelled?uiCalendarConfig.calendars.resourceCalendar.fullCalendar("removeEvents",[response.id]):(booking.resourceId=booking.person_id,uiCalendarConfig.calendars.resourceCalendar.fullCalendar("updateEvent",booking))}}(this)})},pusherBooking=function(res){var booking;return null!=res.id?(booking=_.first(uiCalendarConfig.calendars.resourceCalendar.fullCalendar("clientEvents",res.id)),booking&&booking.$refetch?booking.$refetch().then(function(){return uiCalendarConfig.calendars.resourceCalendar.fullCalendar("updateEvent",booking)}):uiCalendarConfig.calendars.resourceCalendar.fullCalendar("refetchEvents")):void 0},$scope.pusherSubscribe=function(_this){return function(){var pusher_channel;return $scope.company?(pusher_channel=$scope.company.getPusherChannel("bookings"),pusher_channel.bind("create",pusherBooking),pusher_channel.bind("update",pusherBooking),pusher_channel.bind("destroy",pusherBooking)):void 0}}(this),$scope.openDatePicker=function($event){return $event.preventDefault(),$event.stopPropagation(),$scope.datePickerOpened=!0},$scope.updateDate=function(date){return uiCalendarConfig.calendars.resourceCalendar?uiCalendarConfig.calendars.resourceCalendar.fullCalendar("gotoDate",date):void 0},$scope.lazyUpdateDate=_.debounce($scope.updateDate,400),$scope.datePickerOptions={showButtonBar:!1},$scope.$watch("currentDate",function(newDate,oldDate){return $scope.lazyUpdateDate(newDate)}),$scope.$on("refetchBookings",function(){return uiCalendarConfig.calendars.resourceCalendar.fullCalendar("refetchEvents")}),$scope.$on("newCheckout",function(){return uiCalendarConfig.calendars.resourceCalendar.fullCalendar("refetchEvents")})},link=function(scope,element,attrs){return scope.getCompanyPromise().then(function(company){return company.$get("services").then(function(collection){return collection.$get("services").then(function(services){var s;return scope.services=function(){var i,len,results;for(results=[],i=0,len=services.length;len>i;i++)s=services[i],results.push(new BBModel.Admin.Service(s));return results}(),ColorPalette.setColors(scope.services)})})}),scope.getCompanyPromise().then(function(company){return scope.pusherSubscribe()}),$timeout(function(){var datePickerElement,toolbarElement,toolbarLeftElement,uiCalElement;return uiCalElement=angular.element(element.children()[2]),toolbarElement=angular.element(uiCalElement.children()[0]),toolbarLeftElement=angular.element(toolbarElement.children()[0]),datePickerElement=$compile($templateCache.get("calendar_date_picker.html"))(scope),toolbarLeftElement.append(datePickerElement)},0)},{controller:controller,link:link,templateUrl:"resource_calendar_main.html",scope:{labelAssembler:"@",blockLabelAssembler:"@"}}})}.call(this),function(){angular.module("BBAdminDashboard.calendar.services").factory("PrePostTime",["$compile",function($compile){return{apply:function(event,elements,view,scope){var contentDiv,e,element,i,len,post,postHeight,postWidth,pre,preHeight,preWidth,results,totalDuration;for(results=[],i=0,len=elements.length;len>i;i++){if(e=elements[i],element=angular.element(e),totalDuration=event.duration+event.pre_time+event.post_time,event.pre_time)switch(view.name){case"agendaWeek":case"agendaDay":preHeight=event.pre_time*(element.height()+2)/totalDuration,pre=$compile("<div class='pre' style='height:"+preHeight+"px'></div>")(scope),element.prepend(pre);break;case"timelineDay":contentDiv=element.children()[0],preWidth=event.pre_time*(element.width()+2)/totalDuration,pre=$compile("<div class='pre' style='width:"+preWidth+"px'></div>")(scope),element.prepend(pre),angular.element(contentDiv).css("padding-left",preWidth+"px")}if(event.post_time)switch(view.name){case"agendaWeek":case"agendaDay":postHeight=event.post_time*(element.height()+2)/totalDuration,post=$compile("<div class='post' style='height:"+postHeight+"px'></div>")(scope),results.push(element.append(post));break;case"timelineDay":postWidth=event.post_time*(element.width()+2)/totalDuration,post=$compile("<div class='post' style='width:"+postWidth+"px'></div>")(scope),results.push(element.append(post));break;default:results.push(void 0)}else results.push(void 0)}return results}}}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.check-in.controllers").controller("CheckInPageCtrl",["$scope","$state",function($scope,$state){return $scope.adminlte.heading=""}])}.call(this),function(){angular.module("BBAdminDashboard.check-in.directives").directive("bbCheckinTable",function(){return{restrict:"AE",replace:!1,scope:!0,templateUrl:"checkin_table.html",controller:"CheckinsController",link:function(scope,element,attrs){}}}),angular.module("BBAdminDashboard.check-in.directives").controller("CheckinsController",function($scope,$rootScope,BusyService,$q,$filter,AdminTimeService,AdminBookingService,AdminSlotService,$timeout,AlertService){return $scope.getAppointments=function(currentPage,filterBy,filterByFields,orderBy,orderByReverse){var defer,mobile,params;return filterByFields&&null!=filterByFields.name&&(filterByFields.name=filterByFields.name.replace(/\s/g,"")),filterByFields&&null!=filterByFields.mobile&&(mobile=filterByFields.mobile,0===mobile.indexOf("0")&&(filterByFields.mobile=mobile.substring(1))),defer=$q.defer(),params={company:$scope.company,date:moment().format("YYYY-MM-DD"),url:$scope.bb.api_url},filterBy&&(params.filter_by=filterBy),filterByFields&&(params.filter_by_fields=filterByFields),orderBy&&(params.order_by=orderBy),orderByReverse&&(params.order_by_reverse=orderByReverse),AdminBookingService.query(params).then(function(_this){return function(res){var i,item,len,ref;for($scope.booking_collection=res,$scope.bookings=[],$scope.bmap={},ref=res.items,i=0,len=ref.length;len>i;i++)item=ref[i],3!==item.status&&($scope.bookings.push(item.id),$scope.bmap[item.id]=item);return $scope.booking_collection.addCallback($scope,function(booking,status){var j,len1,ref1,results;for($scope.bookings=[],$scope.bmap={},ref1=$scope.booking_collection.items,results=[],j=0,len1=ref1.length;len1>j;j++)item=ref1[j],3!==item.status?($scope.bookings.push(item.id),results.push($scope.bmap[item.id]=item)):results.push(void 0);return results}),defer.resolve($scope.bookings)}}(this),function(err){return defer.reject(err)}),defer.promise},$scope.setStatus=function(_this){return function(booking,status){var clone;return clone=_.clone(booking),clone.current_multi_status=status,booking.$update(clone).then(function(res){return $scope.booking_collection.checkItem(res)},function(err){return AlertService.danger({msg:"Something went wrong"})})}}(this),this.checker=function(_this){return function(){return $timeout(function(){return _this.checker()},1e3)}}(this),$scope.getAppointments(),this.checker()})}.call(this),function(){"use strict";angular.module("BBAdminDashboard.clients.controllers").controller("ClientsAllPageCtrl",["$scope","$state",function($scope,$state){return $scope.set_current_client(null)}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.clients.controllers").controller("ClientsEditPageCtrl",["$scope","client","$state","company","AdminClientService",function($scope,client,$state,company,AdminClientService){return $scope.client=client,$scope.historicalStartDate=moment().add(-1,"years"),$scope.historicalEndDate=moment(),$scope.memberSaveCallback=function(){var params;return params={company_id:company.id,id:$state.params.id,flush:!0},AdminClientService.query(params).then(function(client){return $scope.client=client})}}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.clients.controllers").controller("ClientsNewPageCtrl",["$scope","$state",function($scope,$state){}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.clients.controllers").controller("ClientsPageCtrl",["$scope","$state",function($scope,$state){return $scope.adminlte.heading=null,$scope.clientsOptions={search:null},$scope.adminlte.side_menu=!0,$scope.set_current_client=function(client){return $scope.current_client=client}}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.config-iframe.controllers").controller("ConfigIframePageCtrl",["$scope","$state","$rootScope",function($scope,$state,$rootScope){return $scope.parent_state=$state.is("config"),$scope.path="edit",$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){return $scope.parent_state=!1,"config"===toState.name?$scope.parent_state=!0:void 0})}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.config-iframe.controllers").controller("ConfigSubIframePageCtrl",["$scope","$state","$stateParams",function($scope,$state,$stateParams){return $scope.path=$stateParams.path}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.controllers").controller("CorePageController",["$scope","$state","company",function($scope,$state,company){return $scope.company=company,$scope.bb.company=company,moment.tz.setDefault(company.timezone)}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.directives").directive("lteBody",function(){return{restrict:"AE",replace:!0,scope:!0,link:function(scope,element,attrs){return scope.adminlte||(scope.adminlte={}),scope.setPageTitle=function(title){return $scope.adminlte.title=title},scope.setPageSubtitle=function(subtitle){return $scope.adminlte.subtitle=subtitle},scope.$watch("adminlte.side_menu",function(val){return val?element.removeClass("no-side-menu"):element.addClass("no-side-menu")})}}}),angular.module("BBAdminDashboard.directives").directive("lteSideMenu",function(){return{restrict:"AE",link:function(scope,element,attrs){return scope.adminlte.side_menu=attrs.lteSideMenu}}}),angular.module("BBAdminDashboard.directives").directive("lteNoSideMenu",function(){return{restrict:"AE",link:function(scope,element,attrs){return scope.adminlte?scope.adminlte.side_menu=null:void 0}}}),angular.module("BBAdminDashboard.directives").directive("lteHeading",function(){return{restrict:"AE",link:function(scope,element,attrs){return scope.adminlte.heading=attrs.lteHeading}}}),angular.module("BBAdminDashboard.directives").directive("bbDashboardSidebarWrapper",function($window){return{restrict:"AE",templateUrl:"dashboard_sidebar_wrapper.html",transclude:!0,link:function(scope,element,attrs){return scope.adminlte.side_menu=!0,$window.$.AdminLTE.pushMenu?$window.$.AdminLTE.pushMenu.activate($window.$.AdminLTE.options.sidebarToggleSelector):void 0}}}),angular.module("BBAdminDashboard.directives").directive("bbDashboardContentWrapper",function($window,$rootScope){return{restrict:"AE",templateUrl:"dashboard_content_wrapper.html",transclude:!0,link:function(scope,element,attrs){return $window.addEventListener("message",function(_this){return function(event){return event.data.height&&!scope.adminlte.fixed_page?scope.$apply(function(){return scope.adminlte.iframe_style={height:event.data.height+"px"},$window.$.AdminLTE.layout.fix(),$window.$.AdminLTE.layout.fixSidebar();
}):void 0}}(this))}}}),angular.module("BBAdminDashboard.directives").directive("lteFixHeight",function($window){return{link:function(scope,element,attrs){return $window.$.AdminLTE&&$window.$.AdminLTE.layout?($window.$.AdminLTE.layout.fix(),$window.$.AdminLTE.layout.fixSidebar()):void 0}}}),angular.module("BBAdminDashboard.directives").directive("ltePinBottom",function($window,$bbug){return{restrict:"AE",link:function(scope,element,attrs){var padding,pos;return scope.adminlte.fixed_page?(scope.adminlte.iframe_style="",pos=$bbug(element).position(),padding=element.closest(".content").length?element.closest(".content").css("padding-bottom").replace("px",""):0,$bbug(element).height($window.innerHeight-pos.top-padding+"px"),angular.element($window).bind("resize",function(){return pos=$bbug(element).position(),$bbug(element).height($window.innerHeight-pos.top-padding+"px")})):void 0}}})}.call(this),function(){angular.module("BBAdminDashboard.directives").directive("bbAdminDashboard",function(){var controller;return controller=function($scope,$rootScope,$element,$window,$compile,$localStorage,AdminLoginService,$state,AlertService){var api_url;return api_url=$localStorage.getItem("api_url"),!$scope.bb.api_url&&api_url&&($scope.bb.api_url=api_url),$rootScope.bb=$scope.bb,$compile("<span bb-display-mode></span>")($scope,function(_this){return function(cloned,scope){return $($element).append(cloned)}}(this)),$scope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){return AlertService.clear(),$scope.adminlte.fixed_page=toParams.path&&("view/dashboard/index"===toParams.path||"view%2Fdashboard%2Findex"===toParams.path),$scope.isLoading=!0,toState.redirectTo?(event.preventDefault(),$state.go(toState.redirectTo,toParams)):void 0}),$scope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){return $scope.isLoading=!1}),$scope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){return $scope.isLoading=!1}),$scope.$on("$stateChangeNotFound",function(event,toState,toParams,fromState,fromParams){return $scope.isLoading=!1}),$scope.logout=function(){return $scope.isLoading=!0,AdminLoginService.logout()},$scope.closeAlert=function(alert){return AlertService.closeAlert(alert)}},{restrict:"AE",controller:controller,templateUrl:"admin_dashboard.html"}})}.call(this),function(){angular.module("BBAdminDashboard.directives").directive("bbFrame",function(){return{restrict:"AE",replace:!0,controller:function($scope,$sce){return $scope.frame_src=$sce.trustAsResourceUrl($scope.bb.api_url+"/"+unescape($scope.path)+("?whitelabel=adminlte&uiversion=aphid&"+($scope.extra_params?$scope.extra_params:void 0)))}}})}.call(this),function(){angular.module("BBAdminDashboard.directives").directive("bbIfLogin",function($modal,$log,$q,$rootScope,AdminCompanyService,$compile,$templateCache,ModalForm,BBModel){var compile,link;return compile=function(){return{pre:function(scope,element,attributes){return scope.notLoaded=function(sc){return null},scope.setLoaded=function(sc){return null},scope.setPageLoaded=function(){return null},$rootScope.start_deferred=$q.defer(),$rootScope.connection_started=$rootScope.start_deferred.promise,this.whenready=$q.defer(),scope.loggedin=this.whenready.promise,AdminCompanyService.query(attributes).then(function(company){return scope.company=company,scope.bb||(scope.bb={}),scope.bb.company=company,this.whenready.resolve(),$rootScope.start_deferred.resolve()})},post:function(scope,element,attributes){}}},link=function(scope,element,attrs){},{compile:compile}})}.call(this),function(){angular.module("BBAdminDashboard.filters").filter("minutesToString",function(){return function(minutes,format){return null==format&&(format="HH:mm"),moment(moment.duration(minutes,"minutes")._data).format(format)}})}.call(this),function(){angular.module("BBAdminDashboard.filters").filter("propsFilter",function(){return function(items,props){var keys,out;return out=[],angular.isArray(items)?(keys=Object.keys(props),items.forEach(function(item){var i,itemMatches,prop,text;for(itemMatches=!1,i=0;i<keys.length;){if(prop=keys[i],text=props[prop].toLowerCase(),-1!==item[prop].toString().toLowerCase().indexOf(text)){itemMatches=!0;break}i++}itemMatches&&out.push(item)})):out=items,out}})}.call(this),function(){angular.module("BBAdminDashboard.services").factory("AdminSsoLogin",["halClient","AdminSsoLoginUrl",function(halClient,AdminSsoLoginUrl){return function(sso_token,callback){var data;return data={token:sso_token},halClient.$post(AdminSsoLoginUrl,{},data).then(function(login){var params;return params={auth_token:login.auth_token},login.$get("administrator",params).then(function(admin){return"function"==typeof callback?callback(admin):void 0})})}}])}.call(this),function(){angular.module("BBAdminDashboard.services").factory("AdminSsoLoginUrl",["$rootScope","company_id","$exceptionHandler",function($rootScope,company_id,$exceptionHandler){return null==$rootScope.bb.companyId&&($rootScope.bb.companyId|=company_id),$rootScope.bb.companyId||$exceptionHandler(new Error('Angular value "company_id" is undefined! ')),$rootScope.bb.api_url+"/api/v1/login/admin_sso/"+$rootScope.bb.companyId}])}.call(this),function(){angular.module("BBAdminDashboard.services").factory("BusyService",["$q","$log","$rootScope","AlertService","ErrorService",function($q,$log,$rootScope,AlertService,ErrorService){return{notLoaded:function(cscope){for(cscope.$emit("show:loader",cscope),cscope.isLoaded=!1;cscope;)cscope.hasOwnProperty("scopeLoaded")&&(cscope.scopeLoaded=!1),cscope=cscope.$parent},setLoaded:function(cscope){var loadingFinished;for(cscope.$emit("hide:loader",cscope),cscope.isLoaded=!0,loadingFinished=!0;cscope;)cscope.hasOwnProperty("scopeLoaded")&&($scope.areScopesLoaded(cscope)?cscope.scopeLoaded=!0:loadingFinished=!1),cscope=cscope.$parent;return loadingFinished?$rootScope.$broadcast("loading:finished"):void 0},setPageLoaded:function(scope){return null},setLoadedAndShowError:function(scope,err,error_string){return $log.warn(err,error_string),this.setLoaded(scope),409===err.status?AlertService.danger(ErrorService.getError("ITEM_NO_LONGER_AVAILABLE")):err.data&&"Number of Bookings exceeds the maximum"===err.data.error?AlertService.danger(ErrorService.getError("MAXIMUM_TICKETS")):AlertService.danger(ErrorService.getError("GENERIC"))},areScopesLoaded:function(cscope){var child;if(cscope.hasOwnProperty("isLoaded")&&!cscope.isLoaded)return!1;for(child=cscope.$$childHead;child;){if(!$scope.areScopesLoaded(child))return!1;child=child.$$nextSibling}return!0}}}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.dashboard-iframe.controllers").controller("DashboardIframePageCtrl",["$scope","$state","$window","AdminBookingPopup",function($scope,$state,$window,AdminBookingPopup){return $scope.parent_state=$state.is("view"),$scope.bb.side_menu="dashboard_menu",$scope.path="view/dashboard/index",$window.addEventListener("message",function(_this){return function(event){return event&&event.data&&event.data.type&&"booking"===event.data.type?AdminBookingPopup.open({size:"lg",company_id:$scope.bb.company.id,item_defaults:{date:event.data.date,time:5*event.data.iarray,person:event.data.person,resource:event.data.resource}}):void 0}}(this))}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.dashboard-iframe.controllers").controller("DashboardSubIframePageCtrl",["$scope","$state","$stateParams",function($scope,$state,$stateParams){return $scope.path=$stateParams.path}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.departments.controllers").controller("DepartmentsPageCtrl",["$scope","company","departments","AdminLoginService","$state","$timeout",function($scope,company,departments,AdminLoginService,$state,$timeout){return $scope.company=company,$scope.departments=departments,$scope.selectDepartment=function(department){return AdminLoginService.setCompany(department.id).then(function(user){return $timeout(function(){return $state.go("calendar",{},{reload:!0})})})}}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.login.controllers").controller("LoginPageCtrl",["$scope","$state","AdminLoginService",function($scope,$state,AdminLoginService){return AdminLoginService.isLoggedIn()&&AdminLoginService.logout(),$scope.loginSuccess=function(company){return $scope.company=company,$scope.bb.company=company,$state.go("calendar")}}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.logout.controllers").controller("LogoutPageCtrl",["$scope","$state","AdminLoginService","$timeout",function($scope,$state,AdminLoginService,$timeout){return AdminLoginService.logout(),$timeout(function(){return $state.go("login",{},{reload:!0})})}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.members-iframe.controllers").controller("MembersIframePageCtrl",["$scope","$state","$rootScope","$window",function($scope,$state,$rootScope,$window){return $scope.parent_state=$state.is("members"),$scope.bb.side_menu="member_menu",$scope.path="client",$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){return $scope.adminlte.fixed_page=toParams.fixed,$scope.parent_state=!1,"members"===toState.name?($scope.parent_state=!0,$scope.clearCurrentClient()):void 0}),$scope.setCurrentClient=function(client){return console.log("set current",client),client?($rootScope.client_id=client,$scope.extra_params="id="+client):$scope.clearCurrentClient()},$scope.clearCurrentClient=function(){return $rootScope.client_id=null,$scope.extra_params=""},$window.addEventListener("message",function(_this){return function(event){return event&&event.data&&"client"===event.data.controller&&(event.data.id&&$scope.setCurrentClient(event.data.id),"single"===event.data.action)?$state.go("members.page",{path:"client/single",id:event.data.id}):void 0}}(this))}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.members-iframe.controllers").controller("MembersSubIframePageCtrl",["$scope","$state","$stateParams",function($scope,$state,$stateParams){return $scope.path=$stateParams.path,$stateParams.id?$scope.extra_params="id="+$stateParams.id:$scope.extra_params=""}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.publish-iframe.controllers").controller("PublishIframePageCtrl",["$scope","$state","$rootScope",function($scope,$state,$rootScope){return $scope.parent_state=$state.is("publish"),$scope.path="conf",$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){return $scope.parent_state=!1,"setting"===toState.name?$scope.parent_state=!0:void 0})}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.publish-iframe.controllers").controller("PublishSubIframePageCtrl",["$scope","$state","$stateParams",function($scope,$state,$stateParams){return $scope.path=$stateParams.path}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.settings-iframe.controllers").controller("SettingsIframePageCtrl",["$scope","$state","$rootScope",function($scope,$state,$rootScope){return $scope.parent_state=$state.is("setting"),$scope.path="conf",$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){return $scope.parent_state=!1,"setting"===toState.name?$scope.parent_state=!0:void 0})}])}.call(this),function(){"use strict";angular.module("BBAdminDashboard.settings-iframe.controllers").controller("SettingsSubIframePageCtrl",["$scope","$state","$stateParams",function($scope,$state,$stateParams){return $scope.path=$stateParams.path,$stateParams.id?$scope.extra_params="id="+$stateParams.id:$scope.extra_params=""}])}.call(this);