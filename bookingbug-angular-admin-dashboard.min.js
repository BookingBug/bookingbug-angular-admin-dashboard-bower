(function(){"use strict";var adminbookingapp;adminbookingapp=angular.module("BBAdminDashboard",["trNgGrid","BBAdmin","BBAdminServices","ui.calendar","ngStorage","BBAdminBooking","BBAdmin.Directives","ui.calendar","ngResource","ui.bootstrap","ui.router","ct.ui.router.extras","ngTouch","ngInputDate","ngSanitize","xeditable","ngIdle","ngLocalData"]),angular.module("BBAdminDashboard").config(function($logProvider,$httpProvider){return $logProvider.debugEnabled(!0),$httpProvider.defaults.withCredentials=!0}),angular.module("BBAdminDashboard.Directives",[]),angular.module("BBAdminDashboard.Services",["ngResource","ngSanitize","ngLocalData"]),angular.module("BBAdminDashboard.Controllers",["ngLocalData","ngSanitize"]),angular.module("BBAdminDashboard").run(function(editableOptions){return editableOptions.theme="bs3"}),angular.module("BBAdminDashboard").constant("idleTimeout",600),angular.module("BBAdminDashboard").constant("idleStart",300),angular.module("BBAdminDashboard").config(function($idleProvider,idleStart,idleTimeout){return $idleProvider.idleDuration(idleStart),$idleProvider.warningDuration(idleTimeout)}),angular.module("BBAdminDashboard").config(function($stateProvider,$urlRouterProvider){return $stateProvider.root_state="dashboard",$urlRouterProvider.otherwise("/"+$stateProvider.root_state),$stateProvider.state("root",{template:"<div ui-view></div>",resolve:{user:function($q,AdminLoginService,$timeout,$state){var defer;return defer=$q.defer(),AdminLoginService.user().then(function(user){return user?defer.resolve(user):$timeout(function(){return $state.go("login",{},{reload:!0})})},function(err){return $timeout(function(){return $state.go("login",{},{reload:!0})})}),defer.promise},company:function(user,$q,$timeout,$state){var defer;return defer=$q.defer(),user.getCompanyPromise().then(function(company){return company.companies&&company.companies.length>0?$timeout(function(){return $state.go("departments",{},{reload:!0})}):defer.resolve(company)},function(err){return $timeout(function(){return console.log("failed to get company"),$state.go("login",{},{reload:!0})})}),defer.promise}},controller:"bbAdminRootPageController"}).state("departments",{url:"/departments",controller:function($scope,company,departments,AdminLoginService,$state,$timeout){return $scope.company=company,$scope.departments=departments,$scope.selectDepartment=function(department){return AdminLoginService.setCompany(department.id).then(function(user){return $timeout(function(){return $state.go($stateProvider.root_state,{},{reload:!0})})})}},templateUrl:"admin_departments_page.html",resolve:{user:function($q,AdminLoginService,$timeout,$state){var defer;return defer=$q.defer(),AdminLoginService.user().then(function(user){return user?defer.resolve(user):$timeout(function(){return $state.go("login",{},{reload:!0})})},function(err){return $timeout(function(){return $state.go("login",{},{reload:!0})})}),defer.promise},company:function(user){return user.getCompanyPromise()},departments:function(company,$q,$timeout,$state){var defer;return defer=$q.defer(),company.companies&&company.companies.length>0?defer.resolve(company.companies):$timeout(function(){return $state.go($stateProvider.root_state,{},{reload:!0})}),defer.promise}}}).state("dashboard",{parent:"root",url:"/dashboard",controller:"bbAdminDashboardPageController",templateUrl:"admin_dashboard_page.html"}).state("dashboard.page",{parent:"dashboard",url:"/page/:path",templateUrl:"iframe_page.html",controller:function($scope,$stateParams){return $scope.path=$stateParams.path}}).state("view",{parent:"root",url:"/view",templateUrl:"admin_view_page.html"}).state("view.page",{parent:"view",url:"/page/:path",templateUrl:"iframe_page.html",controller:function($scope,$stateParams){return $scope.path=$stateParams.path}}).state("page",{parent:"root",url:"/page/:path",templateUrl:"iframe_page.html",controller:function($scope,$stateParams){return $scope.path=$stateParams.path}}).state("members",{parent:"root",url:"/members",controller:"bbAdminMembersPageController",templateUrl:"admin_members_page.html"}).state("members.page",{parent:"members",url:"/page/:path/:id",templateUrl:"iframe_page.html",controller:function($scope,$stateParams){return $scope.path=$stateParams.path,$stateParams.id?$scope.extra_params="id="+$stateParams.id:$scope.extra_params=""}}).state("config",{parent:"root",url:"/config",controller:"bbAdminConfigPageController",templateUrl:"admin_config_page.html"}).state("config.page",{url:"/page/:path",templateUrl:"iframe_page.html",controller:function($scope,$stateParams){return $scope.path=$stateParams.path}}).state("settings",{parent:"root",url:"/settings",templateUrl:"admin_settings_page.html",deepStateRedirect:{"default":{state:"settings.page",params:{path:"person"}},params:!0}}).state("settings.page",{parent:"settings",url:"/page/:path",templateUrl:"iframe_page.html",controller:function($scope,$stateParams){return $scope.path=$stateParams.path}}).state("publish",{parent:"root",url:"/publish",controller:"bbAdminPublishPageController",templateUrl:"admin_publish_page.html"}).state("publish.page",{parent:"publish",url:"/page/:path",templateUrl:"iframe_page.html",controller:function($scope,$stateParams){return $scope.path=$stateParams.path}}).state("login",{url:"/login",controller:"bbAdminLoginPageController",templateUrl:"admin_login_page.html"}).state("logout",{url:"/logout",controller:function(AdminLoginService,$state,$timeout){return AdminLoginService.logout(),$timeout(function(){return $state.go("login",{},{reload:!0})})}}).state("checkin",{parent:"root",url:"/checkin",templateUrl:"checkin_page.html"})})}).call(this),function(){angular.module("BBAdminDashboard").controller("bbAdminConfigPageController",function($scope,$sce,$state,$rootScope,$window){return $scope.parent_state=$state.is("config"),$scope.path="edit",$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){return $scope.parent_state=!1,"config"===toState.name?$scope.parent_state=!0:void 0})})}.call(this),function(){angular.module("BBAdminDashboard").controller("bbAdminDashboardPageController",function($scope,$sce,$state,$rootScope,$window,AdminBookingPopup){return $scope.parent_state=$state.is("view"),$scope.bb.side_menu="dashboard_menu",$scope.path="view/dashboard/index",$window.addEventListener("message",function(_this){return function(event){return event&&event.data&&event.data.type&&"booking"===event.data.type?AdminBookingPopup.open({size:"lg",company_id:$scope.bb.company.id,item_defaults:{date:event.data.date,time:5*event.data.iarray,person:event.data.person,resource:event.data.resource}}):void 0}}(this))})}.call(this),function(){angular.module("BBAdminDashboard").controller("bbAdminLoginPageController",function($scope,AdminLoginService,$state,$timeout){return AdminLoginService.isLoggedIn()&&AdminLoginService.logout(),$scope.loginSuccess=function(company){return $scope.company=company,$scope.bb.company=company,$state.go("dashboard")}})}.call(this),function(){angular.module("BBAdminDashboard").controller("bbAdminMembersPageController",function($scope,$sce,$state,$rootScope,$window){return $scope.parent_state=$state.is("members"),$scope.bb.side_menu="member_menu",$scope.path="client",$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){return $scope.adminlte.fixed_page=toParams.fixed,$scope.parent_state=!1,"members"===toState.name?($scope.parent_state=!0,$scope.clearCurrentClient()):void 0}),$scope.setCurrentClient=function(client){return console.log("set current",client),client?($rootScope.client_id=client,$scope.extra_params="id="+client):$scope.clearCurrentClient()},$scope.clearCurrentClient=function(){return $rootScope.client_id=null,$scope.extra_params=""},$window.addEventListener("message",function(_this){return function(event){return event&&event.data&&"client"===event.data.controller&&(event.data.id&&$scope.setCurrentClient(event.data.id),"single"===event.data.action)?$state.go("members.page",{path:"client/single",id:event.data.id}):void 0}}(this))})}.call(this),function(){angular.module("BBAdminDashboard").controller("bbAdminPublishPageController",function($scope,$sce,$state,$rootScope,$window){return $scope.parent_state=$state.is("publish"),$scope.path="conf",$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){return $scope.parent_state=!1,"setting"===toState.name?$scope.parent_state=!0:void 0})})}.call(this),function(){angular.module("BBAdminDashboard").controller("bbAdminRootPageController",function($scope,user,company){return $scope.company=company,$scope.bb.company=company,moment.tz.setDefault(company.timezone)})}.call(this),function(){angular.module("BBAdminDashboard").controller("bbAdminSettingsPageController",function($scope,$sce,$state,$rootScope,$window){return $scope.parent_state=$state.is("setting"),$scope.path="conf",$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){return $scope.parent_state=!1,"setting"===toState.name?$scope.parent_state=!0:void 0})})}.call(this),function(){angular.module("BBAdminDashboard").directive("bbAdminDashboard",function(){var controller;return controller=function($scope,$rootScope,$element,$window,$compile,$localStorage,AdminLoginService,$state,AlertService){var api_url;return api_url=$localStorage.getItem("api_url"),!$scope.bb.api_url&&api_url&&($scope.bb.api_url=api_url),$rootScope.bb=$scope.bb,$compile("<span bb-display-mode></span>")($scope,function(_this){return function(cloned,scope){return $($element).append(cloned)}}(this)),$scope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){return AlertService.clear(),$scope.adminlte.fixed_page=toParams.path&&("view/dashboard/index"===toParams.path||"view%2Fdashboard%2Findex"===toParams.path),$scope.isLoading=!0,toState.redirectTo?(event.preventDefault(),$state.go(toState.redirectTo,toParams)):void 0}),$scope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){return $scope.isLoading=!1}),$scope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){return $scope.isLoading=!1}),$scope.$on("$stateChangeNotFound",function(event,toState,toParams,fromState,fromParams){return $scope.isLoading=!1}),$scope.logout=function(){return $scope.isLoading=!0,AdminLoginService.logout()},$scope.closeAlert=function(alert){return AlertService.closeAlert(alert)}},{restrict:"AE",controller:controller,templateUrl:"admin_dashboard.html"}})}.call(this),function(){"use strict";angular.module("BB").directive("lteBody",function(){return{restrict:"AE",replace:!0,scope:!0,link:function(scope,element,attrs){return scope.adminlte||(scope.adminlte={}),scope.setPageTitle=function(title){return $scope.adminlte.title=title},scope.setPageSubtitle=function(subtitle){return $scope.adminlte.subtitle=subtitle},scope.$watch("adminlte.side_menu",function(val){return val?element.removeClass("no-side-menu"):element.addClass("no-side-menu")})}}}),angular.module("BB").directive("lteSideMenu",function(){return{restrict:"AE",link:function(scope,element,attrs){return scope.adminlte.side_menu=attrs.lteSideMenu}}}),angular.module("BB").directive("lteNoSideMenu",function(){return{restrict:"AE",link:function(scope,element,attrs){return scope.adminlte?scope.adminlte.side_menu=null:void 0}}}),angular.module("BB").directive("lteHeading",function(){return{restrict:"AE",link:function(scope,element,attrs){return scope.adminlte.heading=attrs.lteHeading}}}),angular.module("BBAdminDashboard").directive("bbDashboardSidebarWrapper",function($window){return{restrict:"AE",templateUrl:"dashboard_sidebar_wrapper.html",transclude:!0,link:function(scope,element,attrs){return scope.adminlte.side_menu=!0,$window.$.AdminLTE.pushMenu?$window.$.AdminLTE.pushMenu.activate($window.$.AdminLTE.options.sidebarToggleSelector):void 0}}}),angular.module("BBAdminDashboard").directive("bbDashboardContentWrapper",function($window,$rootScope){return{restrict:"AE",templateUrl:"dashboard_content_wrapper.html",transclude:!0,link:function(scope,element,attrs){return $window.addEventListener("message",function(_this){return function(event){return event.data.height&&!scope.adminlte.fixed_page?scope.$apply(function(){return scope.adminlte.iframe_style={height:event.data.height+"px"},$window.$.AdminLTE.layout.fix(),$window.$.AdminLTE.layout.fixSidebar()}):void 0}}(this))}}}),angular.module("BBAdminDashboard").directive("lteFixHeight",function($window){return{link:function(scope,element,attrs){return $window.$.AdminLTE&&$window.$.AdminLTE.layout?($window.$.AdminLTE.layout.fix(),$window.$.AdminLTE.layout.fixSidebar()):void 0}}}),angular.module("BBAdminDashboard").directive("ltePinBottom",function($window,$bbug){return{restrict:"AE",link:function(scope,element,attrs){var padding,pos;return scope.adminlte.fixed_page?(scope.adminlte.iframe_style="",pos=$bbug(element).position(),padding=element.closest(".content").length?element.closest(".content").css("padding-bottom").replace("px",""):0,$bbug(element).height($window.innerHeight-pos.top-padding+"px"),angular.element($window).bind("resize",function(){return pos=$bbug(element).position(),$bbug(element).height($window.innerHeight-pos.top-padding+"px")})):void 0}}})}.call(this),function(){angular.module("BBAdminDashboard").directive("bbCheckinTable",function(){return{restrict:"AE",replace:!1,scope:!0,templateUrl:"checkin_table.html",controller:"CheckinsController",link:function(scope,element,attrs){}}}),angular.module("BBAdminDashboard").controller("CheckinsController",function($scope,$rootScope,BusyService,$q,$filter,AdminTimeService,AdminBookingService,AdminSlotService,$timeout,AlertService){return $scope.getAppointments=function(currentPage,filterBy,filterByFields,orderBy,orderByReverse){var defer,mobile,params;return filterByFields&&null!=filterByFields.name&&(filterByFields.name=filterByFields.name.replace(/\s/g,"")),filterByFields&&null!=filterByFields.mobile&&(mobile=filterByFields.mobile,0===mobile.indexOf("0")&&(filterByFields.mobile=mobile.substring(1))),defer=$q.defer(),params={company:$scope.company,date:moment().format("YYYY-MM-DD"),url:$scope.bb.api_url},filterBy&&(params.filter_by=filterBy),filterByFields&&(params.filter_by_fields=filterByFields),orderBy&&(params.order_by=orderBy),orderByReverse&&(params.order_by_reverse=orderByReverse),AdminBookingService.query(params).then(function(_this){return function(res){var i,item,len,ref;for($scope.booking_collection=res,$scope.bookings=[],$scope.bmap={},ref=res.items,i=0,len=ref.length;len>i;i++)item=ref[i],3!==item.status&&($scope.bookings.push(item.id),$scope.bmap[item.id]=item);return $scope.booking_collection.addCallback($scope,function(booking,status){var j,len1,ref1,results;for($scope.bookings=[],$scope.bmap={},ref1=$scope.booking_collection.items,results=[],j=0,len1=ref1.length;len1>j;j++)item=ref1[j],3!==item.status?($scope.bookings.push(item.id),results.push($scope.bmap[item.id]=item)):results.push(void 0);return results}),defer.resolve($scope.bookings)}}(this),function(err){return defer.reject(err)}),defer.promise},$scope.setStatus=function(_this){return function(booking,status){return booking.current_multi_status=status,booking.$update(booking).then(function(res){return $scope.booking_collection.checkItem(res)},function(err){return AlertService.danger({msg:"Something went wrong"})})}}(this),this.checker=function(_this){return function(){return $timeout(function(){return _this.checker()},1e3)}}(this),$scope.getAppointments(),this.checker()})}.call(this),function(){angular.module("BBAdminDashboard").directive("bbFrame",function(){return{restrict:"AE",replace:!0,controller:function($scope,$sce){return $scope.frame_src=$sce.trustAsResourceUrl($scope.bb.api_url+"/"+unescape($scope.path)+("?whitelabel=adminlte&uiversion=aphid&"+($scope.extra_params?$scope.extra_params:void 0)))}}})}.call(this),function(){angular.module("BBAdminDashboard").directive("bbIfLogin",function($modal,$log,$q,$rootScope,AdminCompanyService,$compile,$templateCache,ModalForm,BBModel){var compile,link;return compile=function(){return{pre:function(scope,element,attributes){return scope.notLoaded=function(sc){return null},scope.setLoaded=function(sc){return null},scope.setPageLoaded=function(){return null},$rootScope.start_deferred=$q.defer(),$rootScope.connection_started=$rootScope.start_deferred.promise,this.whenready=$q.defer(),scope.loggedin=this.whenready.promise,AdminCompanyService.query(attributes).then(function(company){return scope.company=company,scope.bb||(scope.bb={}),scope.bb.company=company,this.whenready.resolve(),$rootScope.start_deferred.resolve()})},post:function(scope,element,attributes){}}},link=function(scope,element,attrs){},{compile:compile}})}.call(this),function(){angular.module("BBAdminDashboard").directive("bbResourceCalendar",function(uiCalendarConfig,AdminCompanyService,AdminBookingService,AdminPersonService,$q,$sessionStorage,ModalForm,BBModel,AdminBookingPopup,$window,$bbug,ColorPalette,AppConfig,Dialog,$timeout,$compile,$templateCache,BookingCollections,PrePostTime,AdminScheduleService){var controller,link;return controller=function($scope,$attrs){var height;return $scope.eventSources=[{events:function(start,end,timezone,callback){return $scope.loading=!0,$scope.getCompanyPromise().then(function(company){var params;return params={company:company,start_date:start.format("YYYY-MM-DD"),end_date:end.format("YYYY-MM-DD")},AdminBookingService.query(params).then(function(bookings){var b,i,len,ref;for($scope.loading=!1,ref=bookings.items,i=0,len=ref.length;len>i;i++)b=ref[i],b.resourceId=b.person_id,b.useFullTime();return $scope.bookings=bookings.items,callback($scope.bookings)})})}},{events:function(start,end,timezone,callback){return $scope.getCompanyPromise().then(function(company){return AdminScheduleService.getPeopleScheduleEvents(company,start,end).then(function(events){return callback(events)})})}}],$scope.options=$scope.$eval($attrs.bbResourceCalendar),$scope.options||($scope.options={}),height=$scope.options.header_height?$bbug($window).height()-$scope.options.header_height:800,$scope.uiCalOptions={calendar:{schedulerLicenseKey:"0598149132-fcs-1443104297",eventStartEditable:!0,eventDurationEditable:!1,minTime:$scope.options.minTime||"09:00",maxTime:$scope.options.maxTime||"18:00",height:height,header:{left:"today,prev,next",center:"title",right:"timelineDay,timelineDayThirty,agendaWeek,month"},defaultView:"timelineDay",views:{agendaWeek:{slotDuration:$scope.options.slotDuration||"00:05",buttonText:"Week",groupByDateAndResource:!0},month:{eventLimit:5,buttonText:"Month"},timelineDay:{slotDuration:$scope.options.slotDuration||"00:05",eventOverlap:!1,slotWidth:25,buttonText:"Day (5m)",resourceAreaWidth:"18%"},timelineDayThirty:{type:"timeline",slotDuration:"00:30",eventOverlap:!1,slotWidth:25,buttonText:"Day (30m)",resourceAreaWidth:"18%"}},resourceLabelText:"Staff",selectable:!0,resources:function(callback){return $scope.getPeople(callback)},eventDrop:function(event,delta,revertFunc){return Dialog.confirm({model:event,body:"Are you sure you want to move this booking?",success:function(_this){return function(model){return $scope.updateBooking(event)}}(this),fail:function(){return revertFunc()}})},eventClick:function(event,jsEvent,view){return $scope.editBooking(event)},eventRender:function(event,element){var service;return 3===event.status&&element.find(".fc-bg").css({"background-color":"#000"}),service=_.findWhere($scope.services,{id:event.service_id}),service?(element.css("background-color",service.color),element.css("color",service.textColor),element.css("border-color",service.textColor)):void 0},eventAfterRender:function(event,elements,view){return PrePostTime.apply(event,elements,view,$scope),null==event.rendering||"background"!==event.rendering?elements.draggable():void 0},select:function(start,end,jsEvent,view,resource){var rid;return view.calendar.unselect(),rid=null,resource&&(rid=resource.id),$scope.getCompanyPromise().then(function(company){return AdminBookingPopup.open({from_datetime:start,to_datetime:end,item_defaults:{date:start.format("YYYY-MM-DD"),time:60*start.hour()+start.minute(),person:rid},first_page:"quick_pick",company_id:company.id})})},viewRender:function(view,element){var date;return date=uiCalendarConfig.calendars.resourceCalendar.fullCalendar("getDate"),$scope.currentDate=moment(date).format("YYYY-MM-DD")},eventResize:function(event,delta,revertFunc,jsEvent,ui,view){return event.duration=event.end.diff(event.start,"minutes"),$scope.updateBooking(event)}}},$scope.getPeople=function(callback){return $scope.loading=!0,$scope.getCompanyPromise().then(function(company){var params;return params={company:company},AdminPersonService.query(params).then(function(people){var i,len,p,ref;for($scope.loading=!1,$scope.people=_.sortBy(people,"name"),ref=$scope.people,i=0,len=ref.length;len>i;i++)p=ref[i],p.title=p.name;return uiCalendarConfig.calendars.resourceCalendar.fullCalendar("refetchEvents"),callback($scope.people)})})},$scope.updateBooking=function(booking){return booking.person_id=booking.resourceId,booking.$update().then(function(response){return booking.resourceId=booking.person_id,uiCalendarConfig.calendars.resourceCalendar.fullCalendar("updateEvent",booking)})},$scope.editBooking=function(booking){return ModalForm.edit({templateUrl:"edit_booking_modal_form.html",model:booking,title:"Edit Booking",success:function(_this){return function(response){return response.is_cancelled?uiCalendarConfig.calendars.resourceCalendar.fullCalendar("removeEvents",[response.id]):(booking.resourceId=booking.person_id,uiCalendarConfig.calendars.resourceCalendar.fullCalendar("updateEvent",booking))}}(this)})},$scope.pusherSubscribe=function(_this){return function(){return $scope.company?$scope.company.pusherSubscribe(function(res){var booking;return null!=res.id?(booking=_.first(uiCalendarConfig.calendars.resourceCalendar.fullCalendar("clientEvents",res.id)),booking?booking.$refetch().then(function(){return uiCalendarConfig.calendars.resourceCalendar.fullCalendar("updateEvent",booking)}):$scope.company.$get("bookings",{id:res.id}).then(function(response){return booking=new BBModel.Admin.Booking(response),BookingCollections.checkItems(booking),uiCalendarConfig.calendars.resourceCalendar.fullCalendar("refetchEvents")})):void 0},{encrypted:!1}):void 0}}(this),$scope.openDatePicker=function($event){return $event.preventDefault(),$event.stopPropagation(),$scope.datePickerOpened=!0},$scope.updateDate=function(date){return uiCalendarConfig.calendars.resourceCalendar?uiCalendarConfig.calendars.resourceCalendar.fullCalendar("gotoDate",date):void 0},$scope.lazyUpdateDate=_.debounce($scope.updateDate,400),$scope.datePickerOptions={showButtonBar:!1},$scope.$watch("currentDate",function(newDate,oldDate){return $scope.lazyUpdateDate(newDate)})},link=function(scope,element,attrs){return scope.getCompanyPromise=function(){var defer;return defer=$q.defer(),scope.company?defer.resolve(scope.company):AdminCompanyService.query(attrs).then(function(company){return scope.company=company,defer.resolve(scope.company)}),defer.promise},scope.getCompanyPromise().then(function(company){return company.$get("services").then(function(collection){return collection.$get("services").then(function(services){var s;return scope.services=function(){var i,len,results;for(results=[],i=0,len=services.length;len>i;i++)s=services[i],results.push(new BBModel.Admin.Service(s));return results}(),ColorPalette.setColors(scope.services)})})}),scope.getCompanyPromise().then(function(company){return scope.pusherSubscribe()}),$timeout(function(){var datePickerElement,toolbarElement,toolbarLeftElement,uiCalElement;return uiCalElement=angular.element(element.children()[1]),toolbarElement=angular.element(uiCalElement.children()[0]),toolbarLeftElement=angular.element(toolbarElement.children()[0]),scope.currentDate=moment().format(),datePickerElement=$compile($templateCache.get("calendar_date_picker.html"))(scope),toolbarLeftElement.append(datePickerElement)},0)},{controller:controller,link:link,templateUrl:"resource_calendar_main.html"}})}.call(this),function(){angular.module("BB").factory("BusyService",function($q,$log,$rootScope,BBModel,AlertService,ErrorService){return{notLoaded:function(cscope){for(cscope.$emit("show:loader",cscope),cscope.isLoaded=!1;cscope;)cscope.hasOwnProperty("scopeLoaded")&&(cscope.scopeLoaded=!1),cscope=cscope.$parent},setLoaded:function(cscope){var loadingFinished;for(cscope.$emit("hide:loader",cscope),cscope.isLoaded=!0,loadingFinished=!0;cscope;)cscope.hasOwnProperty("scopeLoaded")&&($scope.areScopesLoaded(cscope)?cscope.scopeLoaded=!0:loadingFinished=!1),cscope=cscope.$parent;return loadingFinished?$rootScope.$broadcast("loading:finished"):void 0},setPageLoaded:function(scope){return null},setLoadedAndShowError:function(scope,err,error_string){return $log.warn(err,error_string),this.setLoaded(scope),409===err.status?AlertService.danger(ErrorService.getError("ITEM_NO_LONGER_AVAILABLE")):err.data&&"Number of Bookings exceeds the maximum"===err.data.error?AlertService.danger(ErrorService.getError("MAXIMUM_TICKETS")):AlertService.danger(ErrorService.getError("GENERIC"))},areScopesLoaded:function(cscope){var child;if(cscope.hasOwnProperty("isLoaded")&&!cscope.isLoaded)return!1;for(child=cscope.$$childHead;child;){if(!$scope.areScopesLoaded(child))return!1;child=child.$$nextSibling}return!0}}})}.call(this),function(){angular.module("BBAdminDashboard").factory("PrePostTime",function($compile){return{apply:function(event,elements,view,scope){var contentDiv,e,element,i,len,post,postHeight,postWidth,pre,preHeight,preWidth,results,totalDuration;for(results=[],i=0,len=elements.length;len>i;i++){if(e=elements[i],element=angular.element(e),totalDuration=event.duration+event.pre_time+event.post_time,event.pre_time)switch(view.name){case"agendaWeek":case"agendaDay":preHeight=event.pre_time*(element.height()+2)/totalDuration,pre=$compile("<div class='pre' style='height:"+preHeight+"px'></div>")(scope),element.prepend(pre);break;case"timelineDay":contentDiv=element.children()[0],preWidth=event.pre_time*(element.width()+2)/totalDuration,pre=$compile("<div class='pre' style='width:"+preWidth+"px'></div>")(scope),element.prepend(pre),angular.element(contentDiv).css("padding-left",preWidth+"px")}if(event.post_time)switch(view.name){case"agendaWeek":case"agendaDay":postHeight=event.post_time*(element.height()+2)/totalDuration,post=$compile("<div class='post' style='height:"+postHeight+"px'></div>")(scope),results.push(element.append(post));break;case"timelineDay":postWidth=event.post_time*(element.width()+2)/totalDuration,post=$compile("<div class='post' style='width:"+postWidth+"px'></div>")(scope),results.push(element.append(post));break;default:results.push(void 0)}else results.push(void 0)}return results}}})}.call(this);